const __vite__fileDeps=["assets/theme-1/CommonIndex.B8MPBVWS.js","assets/theme-1/main.C8q1iJMV.js","assets/vendors/vendor-default.CjiYZF7Q.js","assets/vendors/vendor-bignumber.BRr1dcww.js","assets/vendors/vendor-@vue.DNlpgob2.js","assets/vendors/vendor-default.D-eq1dc7.css","assets/vendors/vendor-lodash.BYdGDldS.js","assets/vendors/vendor-swiper.ZXc-sUCV.js","assets/vendors/vendor-swiper.BH51ma1P.css","assets/vendors/vendor-stable.LD58Pbb3.js","assets/vendors/vendor-@intlify.BmUtFfVu.js","assets/vendors/vendor-@sentry.EjpkRnd3.js","assets/vendors/vendor-dom-to-image.C12bjAh8.js","assets/theme-1/main.oUrzxJI4.css","assets/theme-1/Draggable.B6hIaxCA.js","assets/theme-1/Draggable.BNldeGqQ.css","assets/theme-1/CommonIndex.C0qWeuEg.css","assets/theme-1/StyleIndex.By1o2jhK.js","assets/theme-1/StyleIndex.CL8g5YYi.css","assets/theme-1/StyleIndex.BSu6iIVu.js","assets/theme-1/StyleIndex.2kGdHoZp.css","assets/theme-1/StyleIndex.Z4J6w0SX.js","assets/theme-1/StyleIndex.z5avjLZk.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{D as $,u as V,cx as D,cE as q,aA as h,q as x,bw as w,E as N,dv as G,dw as z,dx as Y,dy as K,dz as F,a as j,dA as J,d3 as Q,b3 as X,aF as M,s as Z,aa as W,az as ee,aK as ae,dB as oe,dC as se,dD as ne,dE as k,dF as A,I as te,dG as re,v as le}from"./main.C8q1iJMV.js";import{a as me}from"../vendors/vendor-stable.LD58Pbb3.js";import{l as C,f as R,G as ce,p,r as P,bY as H,w as S,bZ as ie,o as ue,b as ge,q as de,F as pe}from"../vendors/vendor-@vue.DNlpgob2.js";import{Q as fe}from"../vendors/vendor-lodash.BYdGDldS.js";import"../vendors/vendor-default.CjiYZF7Q.js";import"../vendors/vendor-bignumber.BRr1dcww.js";import"../vendors/vendor-swiper.ZXc-sUCV.js";import"../vendors/vendor-@sentry.EjpkRnd3.js";import"../vendors/vendor-dom-to-image.C12bjAh8.js";import"../vendors/vendor-@intlify.BmUtFfVu.js";const ve={1:()=>h(()=>import("./CommonIndex.B8MPBVWS.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16])),8:()=>h(()=>import("./StyleIndex.By1o2jhK.js"),__vite__mapDeps([17,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,18])),9:()=>h(()=>import("./StyleIndex.BSu6iIVu.js"),__vite__mapDeps([19,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,20])),10:()=>h(()=>import("./StyleIndex.Z4J6w0SX.js"),__vite__mapDeps([21,14,1,2,3,4,5,6,7,8,9,10,11,12,13,15,22]))},[be]=x("draggle-ball"),_e=C({name:be,emits:["dragging","dragEnd"],setup(e,{emit:a}){const s=me(),c=$(),{open:u}=V(),i=D(),n=()=>{var l,r,t,d,o,m,v;w.doReport({rule:w.rules.SENSOR_BURIED,eventName:w.sensorEvents.GameReturnClick,payload:{name:(l=i.gameParameters)==null?void 0:l.name,gameCategoryId:(t=(r=i.gameParameters)==null?void 0:r.gameInfo)==null?void 0:t.gameCategoryId,gameType:(o=(d=i.gameParameters)==null?void 0:d.gameInfo)==null?void 0:o.gameType,gameId:(v=(m=i.gameParameters)==null?void 0:m.gameInfo)==null?void 0:v.gameId}}),i.preGameEmbeddedParams.name&&![N.PROMOTE_GAME,N.GAME_EMBEDDED].includes(i.preGameEmbeddedParams.name)?s.push({name:i.preGameEmbeddedParams.name,query:i.preGameEmbeddedParams.query}):G()},g=()=>{n()},I=R(()=>{var r,t;const l=(t=(r=c==null?void 0:c.homeLayoutInfos)==null?void 0:r.commonConfig)==null?void 0:t.hallReturnType;return l&&q.enable&&["8","9","10"].includes(l),"1"}),b=ce(ve[I.value]),f=()=>{u("recharge")};return()=>p(b,{onClick:g,onRechargeClick:f,onDragging:()=>a("dragging"),onDragEnd:()=>a("dragEnd")},null)}}),B=9999,we=()=>"srcdoc"in document.createElement("iframe"),Ie=e=>{const a=we()?{srcdoc:e}:{src:"data:text/html;charset=utf-8;base64,".concat(z(e))};return Y(e)?a:{src:e}},Pe=e=>{const a="allow-scripts allow-same-origin allow-modals allow-popups allow-forms";return e===77e4?a+" allow-top-navigation allow-top-navigation-by-user-activation":a};function he(e,a){const c=new URL(e).origin,u=new RegExp(c,"g");return e.replace(u,a)}async function y(e){return new Promise((a,s)=>{K(e,"game",!1,5e3,!1).then(c=>{a({url:e,ping:c})}).catch(()=>{s({url:e,ping:B})})})}async function ye(e,a){if(!a.length){const n=await y(e).catch(g=>g);return(n==null?void 0:n.ping)<B?[n]:[]}const s=a.map(async n=>y(n).catch(g=>g)),[c,u]=await Promise.all([y(e).catch(n=>n),Promise.any(s)]);return[c,u].filter(n=>(n==null?void 0:n.ping)<B).sort((n,g)=>n.ping-g.ping)}var _=(e=>(e.Register="cocos-register",e.PlayMusic="cocos-play-music",e.Recharge="cocos-recharge",e.Gamesuc="cocos-gamesuc",e.CocosYuEBao="cocos-yuebao",e.CocosGoHomePage="cocos-go-home-page",e))(_||{});function Ee(){const{gameParameters:e}=F(),a=P(!0),{open:s}=V(),{start:c}=H(()=>{a.value=!1},5e3,{immediate:!1}),{t:u}=j(),i=P(""),n=()=>{if(M().getInterestSwitchIsHide){Z({type:"warning",title:u("lobby.common.tips.title"),message:u("lobby.modal.notOpen")});return}s("interest")},g=l=>{const r=l==null?void 0:l.data;if(r===_.Register)window.location.reload();else if(r!==_.PlayMusic)if(r===_.Recharge)s("recharge");else if(r===_.CocosGoHomePage)G();else try{const t=JSON.parse(r);t.data===_.CocosYuEBao&&(n(),t!=null&&t.gold&&M().setCocosGameGold(+t.gold))}catch(t){console.warn("interest err: ".concat(t))}},I=l=>{const r=he(e.value.url,l);i.value=r,a.value=!0,c()},b=()=>{W.showDialog({title:u("lobby.common.tips.title"),message:u("lobby.game.gameEmbedded.networkError"),showCancelButton:!0,onConfirm:G})},f=(l,r)=>{ye(l,r).then(t=>{var o;if(!t.find(m=>m.url===l)){const m=(o=t[0])==null?void 0:o.url;m?I(m):b()}}).catch(b)};return S(e,()=>{var l,r,t,d;if((l=e.value)!=null&&l.url&&((r=e.value)==null?void 0:r.platformId)===J){const o=(t=Q(e.value.url))==null?void 0:t.other,m=(d=new URL(e.value.url))==null?void 0:d.origin,v=fe(o==null?void 0:o.split(";"));f(m,v)}},{immediate:!0}),X("message",g),{start:c,loading:a,currentSelftGameUrl:i}}const De="_iframeBox_1lv74_17",Ge="_iframe_1lv74_17",Re="_loading_1lv74_31",Se="_overlayBox_1lv74_41",E={iframeBox:De,iframe:Ge,loading:Re,overlayBox:Se},[Be]=x("game-iframe"),xe=C({name:Be,setup(){const e=ee(),a=D(),{gameParameters:s}=F(),{isMobile:c}=ae(),{start:u,loading:i,currentSelftGameUrl:n}=Ee(),{isFullscreen:g,enter:I,exit:b}=ie(),f=P(null),l=R(()=>{var o,m;return n.value?{src:n.value}:Ie((m=(o=s.value)==null?void 0:o.url)!=null?m:"")}),r=R(()=>{var o,m;return Pe((m=(o=s.value)==null?void 0:o.gameInfo)==null?void 0:m.gameId)}),t=()=>{f.value&&(f.value.onload=()=>{i.value=!1})};S(g,()=>{const{setFullScreen:o}=D();o(g.value)}),S(s,()=>{var o;(o=s.value)!=null&&o.url&&c&&!(oe||se)&&I()},{immediate:!0}),ue(()=>{(!a.isGamePlaying||!a.preGameEmbeddedParams.name)&&ne(),k.pauseInManual(A.RED_POCKETS),t(),u()});const d=()=>{var o,m,v,O,L,T,U;b(),a.setGameScoring(!1),a.setGameOpening(!1),a.setGamePlaying(!1),e.hasLogined&&s.value&&(w.doReport({rule:w.rules.SENSOR_BURIED,eventName:w.sensorEvents.GameReturnLobby,payload:{name:(o=s.value)==null?void 0:o.name,gameCategoryId:(v=(m=s.value)==null?void 0:m.gameInfo)==null?void 0:v.gameCategoryId,gameType:(L=(O=s.value)==null?void 0:O.gameInfo)==null?void 0:L.gameType,gameId:(U=(T=s.value)==null?void 0:T.gameInfo)==null?void 0:U.gameId}}),re.logoutAndUpdatePrize()),a.setGameParameters({}),k.recoverInManual(A.RED_POCKETS)};return ge(()=>{d()}),()=>{var o;return p("div",{class:E.iframeBox},[i.value&&p(te,{src:"/lobby_asset/common/web/animated/apng_loading_game.png",class:E.loading},null),p("iframe",de({ref:f,class:E.iframe},l.value,{title:(o=s.value)==null?void 0:o.name,frameborder:"0",scrolling:"auto",allow:"clipboard-write; clipboard-read; web-share",sandbox:r.value,allowfullscreen:!1}),null)])}}}),Ce="_iframeDraggle_17xwz_17",Oe={iframeDraggle:Ce},[Le]=x("pages-game-embedded"),Te=C({name:Le,setup(){const e=P(!1),a=P(!1),s=()=>{a.value=!0},c=()=>{a.value=!1};return H(()=>{e.value=!0},4e3),()=>p(le,null,{default:()=>p(pe,null,[e.value&&p(_e,{onDragging:s,onDragEnd:c},null),p(xe,{class:{[Oe.iframeDraggle]:a.value}},null)])})}}),ze=Te;export{ze as default};
//# sourceMappingURL=EmbeddedIndex.XCGI58ca.js.map
