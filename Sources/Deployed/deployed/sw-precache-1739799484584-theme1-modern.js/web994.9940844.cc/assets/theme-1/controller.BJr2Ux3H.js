import{A as f,u as P,a as k,s as A,o as v,E as w,n as y,b as E,c as T,r as L,g,d as p,e as x,f as l,h as W,i as b,j as C,k as D}from"./main.C8q1iJMV.js";import{o as I}from"../vendors/vendor-lodash.BYdGDldS.js";import"../vendors/vendor-default.CjiYZF7Q.js";import"../vendors/vendor-bignumber.BRr1dcww.js";import"../vendors/vendor-@vue.DNlpgob2.js";import"../vendors/vendor-swiper.ZXc-sUCV.js";import"../vendors/vendor-stable.LD58Pbb3.js";import"../vendors/vendor-@intlify.BmUtFfVu.js";import"../vendors/vendor-@sentry.EjpkRnd3.js";import"../vendors/vendor-dom-to-image.C12bjAh8.js";let a=null;const M=(e,s)=>{if(!a||!a[e]){a||(a={[e]:[]}),a[e]||(a[e]=[]);const t=o=>{a[e].forEach(r=>r(o))};document.body.addEventListener("click",t)}a[e].push(s)},N=e=>{M("click",s=>{const t=s.target;if(t.nodeName.toLocaleLowerCase()!=="a")return;const o=t.getAttribute("href");o&&!["#","/"].includes(o[0])&&(s.preventDefault(),e({href:o,event:s}))})},u={Paymodal:v},R=(e,s)=>{var t;try{return(t=u[e])!=null&&t.call(u,s)||P().open(e,s),!0}catch(o){return!1}},S=(e,s)=>{const{t}=k();A({type:"error",title:()=>t("lobby.common.tips.title"),className:"host-envs_tg-micro-app",confirmButtonText:()=>t("lobby.common.tips.confirm"),message:()=>"".concat(t("lobby.error.microAppLoginFailed"),"[").concat(e||"Network Error","]"),showCancelButton:!1,showCloseButton:!1,closeOnRouteChange:!1,onConfirm:s})},q=f.createPrivateLock.bind(f),O={[w.WITHDRAW]:y},d=e=>new Promise(s=>{try{if(!e)return!1;const t=E();let o;if(typeof e=="string")o=O[e]||(()=>t.push(e));else{const{name:r,query:i,replace:h,back:_}=e,c={};r&&(c.name=r),i&&(c.query=i),_?o=()=>t.back():h?o=()=>t.replace(c):o=()=>t.push(c)}Promise.resolve(o()).then(r=>s(!(r instanceof Error))).catch(()=>s(!1))}catch(t){s(!1)}}),G=e=>new Promise(s=>{try{return T().thirdPartyLogin(e,()=>s({success:!0}),()=>s({success:!1,message:"Not Get Data Or Code Not Equals 100"})).catch(t=>{const{code:o,msg:r}=L(t);s({success:!1,message:r&&o?"".concat(r,",").concat(o):"Unknown Error"})})}catch(t){s({success:!1,message:(t==null?void 0:t.message)||"Application Error"})}}),$=!!(window.TelegramWebviewProxy&&window.TelegramWebviewProxy.postEvent),m=D("tGMicroAppConfig"),n=(e,s)=>{$?window.TelegramWebviewProxy.postEvent(e,JSON.stringify(s||{})):window.self!==window.top&&window.parent.postMessage(JSON.stringify({eventType:e,eventData:s}),"https://web.telegram.org")},X=e=>{n("web_app_open_link",{url:e})},Y=()=>{n("web_app_close")},Z=async()=>{var s;const e=l.loginProcess.key;try{const t=g();if(p(e,{execute:!0}),!t.token)throw"Token Is Not Found";const{success:o,message:r}=await G({requester_type:x.TG_MICRO_APPLICATION,access_token:t.token});if(!o)throw r;return p(e,{status:!0}),(s=t.modal)!=null&&s.name&&R(t.modal.name),!0}catch(t){return p(e,{status:null}),S("".concat(t),()=>n("web_app_close")),!1}},ee=()=>{var t;const e=l.navigationProcess.key,s=(t=g().route)==null?void 0:t.name;!s||W(e).execute||(p(e,{execute:!0}),b(l.loginProcess.key,(o,r)=>{o.status?s===w.WITHDRAW?y():d({name:s}):o.status===null&&r()}))},te=async e=>{n("web_app_expand"),n("web_app_setup_closing_behavior",{need_confirmation:!0}),n("web_app_setup_swipe_behavior",{allow_vertical_swipe:!1}),N(({href:r})=>{n("web_app_open_link",{url:r})});const s=g(e.activationParams),t=C();if(m.set("tgWebAppStartParam",e.activationParams),m.set("accessToken",s.token),t.tgWebAppStartParam){const r={...I(t,"tgWebAppStartParam"),isTGMicroApp:"true"};setTimeout(()=>{d({query:r,replace:!0})})}const o=q();b(l.loginProcess.key,(r,i)=>{r.status!==!1&&i(),r.status===!0&&(o==null||o())})};export{Y as exit,te as init,Z as loginProcess,ee as navigationProcess,X as openExternalLink};
//# sourceMappingURL=controller.BJr2Ux3H.js.map
