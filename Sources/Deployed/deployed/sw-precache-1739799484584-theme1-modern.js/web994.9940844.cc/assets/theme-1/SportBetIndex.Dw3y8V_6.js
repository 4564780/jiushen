import{a as V,dY as C,hC as q,R as K,ez as W,q as H,e1 as Q,e6 as J,dP as X,dS as Z,u as ee,d$ as te,I as N,k4 as ae,w as O,k5 as se,a6 as ne,dQ as oe,bN as re,gO as le}from"./main.C8q1iJMV.js";import{B as ie,a as ce,E as ue,b as me}from"./ResultMsgIndex.D8EMTOat.js";import{e as L,v as de}from"../vendors/vendor-default.CjiYZF7Q.js";import"../vendors/vendor-bignumber.BRr1dcww.js";import"../vendors/vendor-swiper.ZXc-sUCV.js";import{B as ve}from"./BetPriceBoxIndex.0wG_1LJ-.js";import{M as pe}from"./MarketTabsIndex.CDUHicku.js";import{l as D,r as l,p as s,F as G,A as fe,h as ye,w as be,n as Ie,f as R,v as A,q as U}from"../vendors/vendor-@vue.DNlpgob2.js";import{m as w,c as ke}from"../vendors/vendor-lodash.BYdGDldS.js";import{B as Se}from"./BetResultIndex.BrrQ76O-.js";import"../vendors/vendor-stable.LD58Pbb3.js";import"../vendors/vendor-@intlify.BmUtFfVu.js";import"../vendors/vendor-@sentry.EjpkRnd3.js";import"../vendors/vendor-dom-to-image.C12bjAh8.js";import"./ArrowPriceIndex.D_dprz8o.js";import"./SymbolPriceIndex.DnolemMB.js";const x={"content-main":"_content-main_2dtfd_17","content-item":"_content-item_2dtfd_27","item-name":"_item-name_2dtfd_30","item-list":"_item-list_2dtfd_45"},[ge]=H("pages-dialogs-sport-bet-tabs"),Be=D({name:ge,props:{eventId:{type:Number,required:!0},selection:Object,loading:Boolean},emits:["resetData","changeSelection"],setup(r,{emit:y}){const{t:u}=V(),S=l(),i=C(),{visible:d}=q("sportBet"),b=l(!0),n=l(),v=l({});K({initTabs:async()=>{var e,o,I,f;if(b.value=!0,!i.marketList.length&&!await i.fetchEventsAndMarkets())return;b.value=!1,d.value&&(i.openBetSSEWatch=!0);const t=(e=r.selection)==null?void 0:e.sortMarketId;t&&(n.value=t,v.value=(f=((I=(o=i.marketList.find(c=>c.marketId===t))==null?void 0:o.selections)!=null?I:[]).find(c=>Q(c,r.selection)))!=null?f:{},p({index:i.marketList.findIndex(c=>c.marketId===n.value)}))}});const p=({index:t})=>{var e,o;(o=(e=S.value)==null?void 0:e.virtualizer)==null||o.scrollToIndex(t,{align:"start"})},B=(t,e)=>s(ve,{modelValue:v.value,"onUpdate:modelValue":o=>v.value=o,market:t,selection:e,onChange:()=>{y("changeSelection",{betTypeInfo:{type:t.betType,name:t.betTypeName},market:t,selection:v.value})}},null);return()=>{var t;return s(G,null,[s(pe,{modelValue:n.value,"onUpdate:modelValue":e=>n.value=e,onClickTab:p},null),s(W,{ref:S,class:x["content-main"],emptyText:u("lobby.selfoperatedGames.sports.noEventsYet"),loading:r.loading||b.value,virtualOptions:{total:(t=i.marketList.length)!=null?t:0,estimateSize:"1rem"}},{default:e=>{var f;const o=(f=e==null?void 0:e.index)!=null?f:0,I=i.marketList[o];return s("div",{class:x["content-item"],key:o},[s("div",{class:x["item-name"]},[I.betTypeName]),s("div",{class:x["item-list"]},[I.selections.map(c=>B(I,c))])])}})])}}}),_e="_teams_15rrk_17",Te="_team_15rrk_17",he="_img_15rrk_30",xe="_score_15rrk_35",Ee="_placeholder_15rrk_45",k={teams:_e,team:Te,img:he,score:xe,placeholder:Ee},[we]=H("pages-dialogs-sport-bet-content"),Pe=D({name:we,props:{market:{type:Object,required:!0},selection:{type:Object,required:!0}},emits:["beted"],setup(r,{emit:y}){const{t:u}=V(),S=l(),i=J(),d=X(),b=Z(),n=C(),v=ee(),g=l(!1),p=l(!1),B=l({minBet:r.market.minBet,maxBet:r.market.maxBet});fe(ie,B);const t=ye({type:r.market.betType,name:r.market.betTypeName}),e=l({}),o=l(r.market);be(()=>r.selection,async()=>{r.selection.eventId&&(e.value=r.selection,o.value=r.market,await Ie(),f())},{immediate:!0});const I=async()=>{var h,T;p.value=!0;const[a,_]=await L(ae({sportType:e.value.sportType,marketId:e.value.marketId,key:e.value.key,oddsType:i.oddsKey}));if(p.value=!1,a){if(g.value=!1,n.openBetSSEWatch=!1,d.isAuthError)return;O.error((h=a.message)!=null?h:u("lobby.selfoperatedGames.sports.marketParlayError"));return}g.value=!0;const m=(T=_.data)!=null?T:{};n.updateEventInfo(w(n.eventInfo,{gameInfo:{liveHomeScore:m.liveHomeScore,liveAwayScore:m.liveAwayScore}})),B.value={maxBet:m.maxBet,minBet:m.minBet},Object.keys(e.value).forEach(E=>{m[E]!==void 0&&(e.value[E]=m[E])})},f=async()=>{var a;await((a=S.value)==null?void 0:a.initTabs()),await I(),n.updateSelections({...e.value,unbetable:c.value})},c=R(()=>{var a;return!g.value||!n.eventInfo.eventId||o.value.marketStatus!==te.Running||((a=e.value.price)!=null?a:0)<=0}),$=async({betTypeInfo:a,selection:_,market:m})=>{t.type=a.type,t.name=a.name,e.value=w({},e.value,_),o.value=w({},o.value,m),await I(),n.updateSelections({...e.value,unbetable:c.value})},j=async({betAmount:a,betMsg:_})=>{var T;p.value=!0;const[m,h]=await L(se({vendorTransId:de(),sportType:e.value.sportType,marketId:e.value.marketId,price:Number(e.value.price),point:e.value.point,key:e.value.key,stake:a,oddsOption:i.oddsOption,oddsType:i.oddsKey}));if(p.value=!1,m){if(d.isAuthError)return;y("beted",{isBetSuccess:!1,betResultMsg:(T=m.message)!=null?T:u("lobby.selfoperatedGames.sports.betFalid"),betTypeInfo:t,selection:e.value});return}if(h.data.betStatus===ue.Fail){f(),O.error(u("lobby.selfoperatedGames.sports.oddsChanged"));return}y("beted",{isBetSuccess:!0,betResultMsg:_,betTypeInfo:t,selection:e.value})},z=()=>{b.doParlay({market:o.value,selection:e.value}),v.close("sportBet")},F=()=>{n.resError=!1,oe().sportAuthErrorHandler({loginType:"all",onLogin:()=>(f(),Promise.resolve())})},M=R(()=>{const a=n.eventInfo.eventId;return d.isAuthError||n.resError?"retry":!a||a!==e.value.eventId?"empty":null}),Y=()=>{var a;return M.value?s(ne,{class:k.placeholder,type:M.value,empty:{text:u("lobby.selfoperatedGames.sports.noEventsYet")},onRetry:F},null):s(Be,{ref:S,eventId:(a=e.value.eventId)!=null?a:0,selection:e.value,onResetData:f,onChangeSelection:$},null)};return()=>{const a=n.eventInfo;return s(G,null,[a.eventId&&s("div",{class:k.teams},[s("span",{class:k.team},[s(N,{class:k.img,src:a.teamInfo.homeIconUrl,useSkeleton:!0},null),a.teamInfo.homeName,A("【"),u("lobby.selfoperatedGames.sports.home"),A("】")]),s("span",{class:k.score},[a.gameInfo.liveHomeScore]),s("span",{class:k.score},[a.gameInfo.liveAwayScore]),s("span",{class:k.team},[s(N,{class:k.img,src:a.teamInfo.awayIconUrl,useSkeleton:!0},null),a.teamInfo.awayName])]),Y(),s(ce,U({mode:"normal",unbetable:c.value,betLoading:p.value,canParlay:a.isParlay&&o.value.combo!==0,price:e.value.price},{onBet:j,onDoParlay:z}),null)])}}}),Ce="_balance_n9iuq_27",P={"sport-bet":"_sport-bet_n9iuq_17","header-title":"_header-title_n9iuq_23",balance:Ce},[He]=H("pages-dialogs-sport-bet"),Ke=D({name:He,setup(){const r=re(),y=C(),{visible:u,onDialogOpen:S,onDialogClose:i}=q("sportBet"),d=l(!1),b=l({}),n=l({}),v=l({});S(async t=>{t&&(d.value=!1,n.value=t.market,v.value={sportType:n.value.sportType,eventId:n.value.eventId,sortMarketId:n.value.marketId,marketId:n.value.marketId,...t.selection})}),i(t=>{t!=null&&t.fromDetail||(y.openBetSSEWatch=!1),y.isShowingBetDialog=!1});const g=t=>{d.value=!0,b.value=ke(t),t.isBetSuccess&&r.updatePrize()},p=()=>{d.value=!1,v.value=b.value.selection},B=()=>d.value?s(Se,U({teamInfo:y.eventInfo.teamInfo},b.value,{onContinue:p}),null):s(Pe,{market:n.value,selection:v.value,onBeted:g},null);return()=>{var t;return s(le,{class:P["sport-bet"],modelValue:u.value,"onUpdate:modelValue":e=>u.value=e,title:(t=y.eventInfo.leagueName)!=null?t:"",titleClass:P["header-title"],closeOnClickOverlay:!0,onClose:()=>{u.value=!1}},{default:()=>[s("div",{class:P.balance},[s(me,null,null)]),B()]})}}});export{Ke as default};
//# sourceMappingURL=SportBetIndex.Dw3y8V_6.js.map
