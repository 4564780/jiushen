import{az as H,jT as B,jU as O,f3 as $,jV as U,f2 as ae,f1 as oe,ch as re,g5 as ce,jW as p,D as le,jX as A,I as q,jY as G,jZ as w,aN as ie,aO as de,a1 as ue,U as ee,cs as _e,j_ as me,fc as Z,j$ as D,k0 as X,k1 as ge,u as F,fI as ve}from"./main.C8q1iJMV.js";import{s as R,b as ye}from"../vendors/vendor-stable.LD58Pbb3.js";import{d as J}from"../vendors/vendor-default.CjiYZF7Q.js";import{r as Y,l as te,w as fe,b9 as Ie,f as j,p as s,F as be,C as he}from"../vendors/vendor-@vue.DNlpgob2.js";import{u as Se}from"./useListDependencies.D4sBXZA5.js";import{c as K}from"../vendors/vendor-lodash.BYdGDldS.js";import"../vendors/vendor-bignumber.BRr1dcww.js";import"../vendors/vendor-swiper.ZXc-sUCV.js";import"../vendors/vendor-@sentry.EjpkRnd3.js";import"../vendors/vendor-dom-to-image.C12bjAh8.js";import"../vendors/vendor-@intlify.BmUtFfVu.js";const Te=()=>{const y=H(),{hasLogined:E,userInfos:S}=R(y),N=Y(0),L=r=>r.sort((d,c)=>{if(d.forceType!==c.forceType)return d.forceType-c.forceType}),P=r=>{var g,x;const d=B(),{frameBoxInfos:c}=R(d),n=c.value.find(l=>Number("".concat(l.triggerId||"").concat(l.id))==r),u=c.value.findIndex(l=>Number("".concat(l.triggerId||"").concat(l.id))==r),b=J().format("YYYY-MM-DD");if(n){if([n.frameType,n.frame_type].includes(O.LOGIN)&&d.setLoginNotRemindIds(r),[n.frameType,n.frame_type].includes(O.ONE)){const l=$.localStorage.get("onceNotRemindIds")||[];let h=l.find(T=>{var k;return T.platformId===((k=S.value)==null?void 0:k.platfromid)})||{};Array.isArray(h.ids)?h.ids.includes(n.id)||h.ids.push(n.id):h={ids:[n.id],platformId:(g=S.value)==null?void 0:g.platfromid},$.localStorage.set("onceNotRemindIds",[...l,h])}if([n.frameType,n.frame_type].includes(O.DAY)){const l=$.localStorage.get("dailyNotRemindIds")||[],h=l.find(T=>{var k;return T.id===n.id&&T.platformId===((k=S.value)==null?void 0:k.platfromid)});h?h.recordTime=b:l.push({id:n.id,recordTime:b,platformId:(x=S.value)==null?void 0:x.platfromid}),$.localStorage.set("dailyNotRemindIds",l)}if(E.value)n.read_status=n.read_status?n.read_status:U.Read,d.setFrameBoxInfos([...c.value.slice(0,u),n,...c.value.slice(u+1)]),n.read||ae({id:n.id,type:n.forceType,triggerId:n==null?void 0:n.triggerId});else if(!n.read){n.read=!0,d.setFrameBoxInfos([...c.value.slice(0,u),n,...c.value.slice(u+1)]);const l=[];c.value.forEach(T=>{T.read&&l.push(T.id)});const h={ids:l,date:b};$.localStorage.set("frameBoxReadState",h)}}};return{activeKey:N,customSort:L,changeReadState:P,handlerTabsChange:r=>{P(r);const{frameBoxInfos:d}=B(),c=d.find(n=>Number("".concat(n.triggerId||"").concat(n.id))==r);c&&(N.value=Number("".concat(c.triggerId||"").concat(c.id)))},handleNotShowAction:r=>{var x;const d=B(),{frameBoxInfos:c}=R(d),n=H(),{userInfos:u}=R(n),b=c.value.find(l=>Number("".concat(l.triggerId||"").concat(l.id))==N.value);b&&(b.not_remind_again=!b.not_remind_again);let g=$.localStorage.get("notShowPopupInfos")||[];r?g.push({id:N.value,recordTime:J().format("YYYY-MM-DD"),platformId:(x=u.value)==null?void 0:x.platfromid}):g.length>0&&(g=g.filter(l=>l.id!==N.value)),$.localStorage.set("notShowPopupInfos",g)},handleFrameBoxInfos:r=>(r.content=oe(r.content,{allowRedirects:"true"}),r&&r.is_maintenance&&(r.content=(()=>{const d=b=>new RegExp("(<|&lt;)"+b+"\\/?(>|&gt;)","g"),{updateMaintainTimeInfo:c}=re(),n={start_time:r.maintenance_start,end_time:r.maintenance_end};c(n),ce("MAINTAIN_MESSAGE").emit(n);const u=p({start_time:r.maintenance_start,end_time:r.maintenance_end});return r.content.replace(d("t_start"),(u==null?void 0:u.start)||"").replace(d("t_end"),(u==null?void 0:u.end)||"").replace(d("t_duration"),String(u==null?void 0:u.duration)||"")})()),r)}},Ne="_main_q7vue_17",xe="_content_q7vue_17",ke="_scrollWrapper_q7vue_25",Ce="_maintenanceTime_q7vue_32",$e="_title_q7vue_37",qe="_text_q7vue_47",we="_popupContent_q7vue_57",Be="_layout1_q7vue_80",Ee="_layout4_q7vue_80",Re="_commonTabs_q7vue_83",Pe="_noBackImg_q7vue_111",Me="_backImg_q7vue_112",We="_layout2_q7vue_125",Ue="_layout3_q7vue_125",Le="_buttomBtn_q7vue_188",Oe="_popupStyle1_q7vue_191",Ae="_popupStyle2_q7vue_192",De="_popupStyle3_q7vue_193",je="_popupStyle4_q7vue_194",He="_pageBtn_q7vue_200",Fe="_pagePre_q7vue_218",Ye="_pageNext_q7vue_224",Ve="_imgIconWrap_q7vue_250",ze="_agreedWrap_q7vue_263",Ge="_closeBtn_q7vue_266",Ze="_imgIcon_q7vue_250",Xe="_nonCustom_q7vue_277",Je="_tabsItem_q7vue_102",Ke="_icon_q7vue_102",Qe="_noRead_q7vue_302",pe="_tabsLabel_q7vue_103",et="_titleContent_q7vue_321",tt="_agreedBox_q7vue_330",nt="_checkWrapper_q7vue_351",st="_tips_q7vue_372",o={main:Ne,content:xe,scrollWrapper:ke,maintenanceTime:Ce,title:$e,text:qe,popupContent:we,layout1:Be,layout4:Ee,commonTabs:Re,noBackImg:Pe,backImg:Me,layout2:We,layout3:Ue,buttomBtn:Le,popupStyle1:Oe,popupStyle2:Ae,popupStyle3:De,popupStyle4:je,pageBtn:He,pagePre:Fe,pageNext:Ye,imgIconWrap:Ve,agreedWrap:ze,closeBtn:Ge,imgIcon:Ze,nonCustom:Xe,tabsItem:Je,icon:Ke,noRead:Qe,tabsLabel:pe,titleContent:et,agreedBox:tt,checkWrapper:nt,tips:st};function at(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!he(y)}const[ot]=ee("forcePopup"),rt=te({name:ot,setup(){const{activeKey:y,handlerTabsChange:E,customSort:S,handleNotShowAction:N,changeReadState:L,handleFrameBoxInfos:P}=Te(),V=B(),{frameBoxInfos:M}=R(V),z=H(),{hasLogined:r}=R(z),{homeLayoutInfos:d}=le(),c=Y({}),n=Y(!1),u=()=>{const e=M.value.find(t=>Number("".concat(t.triggerId||"").concat(t.id))==y.value);e&&(B().setItemStatus(e),L(Number("".concat(e.triggerId||"").concat(e.id))),c.value=P(K(e)),n.value=e==null?void 0:e.not_remind_again)};fe(()=>y.value,e=>{const t=M.value.find(a=>Number("".concat(a.triggerId||"").concat(a.id))===e);t&&(n.value=t==null?void 0:t.not_remind_again,c.value=P(K(t)))},{immediate:!0}),Ie(()=>{u()});const{t:b}=ye(),g=j(()=>{const e=M.value.map(t=>{let a,i;return t.forceType===A.NOTICE&&(i="/lobby_asset/common/web/message/icon_message_tz.svg",a=s(q,{src:i},null)),t.forceType===A.ANNOUNCEMENT&&(i="/lobby_asset/common/web/message/icon_message_xx.svg",a=s(q,{src:i},null)),t.forceType===A.PUBLICIZE&&(i="/lobby_asset/common/web/message/icon_message_pmd.svg",a=s(q,{src:i},null)),{read:t.read,key:Number("".concat(t.triggerId||"").concat(t.id)),id:t.id,triggerId:t.triggerId,value:t.is_maintenance?b("lobby.modal.force.serviceUpgrade").toString():t.publicity_name||t.title,icon:a,forceType:t.forceType,not_remind_again:t.not_remind_again,read_status:t.read_status}});return S(e)}),x=Se(g,e=>e.key+(r.value?e.read_status===U.Unread:!e.read).toString()),l=(e,t)=>{e.stopPropagation(),e.stopImmediatePropagation();const a=S(M.value),i=a.findIndex(_=>{var I,v;return Number("".concat(_.triggerId||"").concat(_.id))==Number("".concat(((I=c.value)==null?void 0:I.triggerId)||"").concat((v=c.value)==null?void 0:v.id))});if(i!==-1){let _=t===D.PREVIEW?i-1:i+1;(_<0||_>=a.length)&&(_=0);const I=a[_];E(Number("".concat(I.triggerId||"").concat(I.id)))}},h=e=>{const t=i=>new RegExp("(<|&lt;)"+i+"\\/?(>|&gt;)","g"),a=p({start_time:e.maintenance_start,end_time:e.maintenance_end});return e.content.replace(t("t_start"),(a==null?void 0:a.start)||"").replace(t("t_end"),(a==null?void 0:a.end)||"").replace(t("t_duration"),String(a==null?void 0:a.duration)||"")},T=e=>e.replace(/<[^>]*>/g,""),k=e=>{var _,I;const t=document.createElement("div");t.innerHTML=e,((_=t.childNodes)==null?void 0:_.length)===1&&((I=t.childNodes[0])==null?void 0:I.nodeName)==="#text"&&(t.style.whiteSpace="break-spaces");const i=t.getElementsByTagName("table");if(i.length){for(const v in i)if(Object.prototype.hasOwnProperty.call(i,v)){const C=i[v],f=C.style.width;if(f.includes("px")){const W=Number(f.replace(/px/g,""));!isNaN(Number(W))&&W>640&&(C.style.width="100%")}}}return t.outerHTML},ne=e=>{var C;const t=j(()=>{const f=e.is_maintenance?h(e):e.content;return k(f)}),a=e.img_style||w.TEXT_INTRODUCTION,i=e.img_color||a===w.CUSTOMIZE&&e.img_url,_=a===w.CUSTOMIZE,I=j(()=>g.value.findIndex(f=>Number("".concat(f.triggerId||"").concat(f.id))==y.value));let v=!1;return(C=e==null?void 0:e.img_url)!=null&&C.includes("system_message_set")&&[w.IMG_LEFT,w.IMG_RIGHT].includes(e.img_style)&&(v=!0),s(q,{src:_||v?e.img_url:e.img_color,tag:"div",class:{[o["popupStyle".concat(a)]]:!0,[o.backImg]:i,[o.noBackImg]:!i,[o.nonCustom]:!_},style:{backgroundSize:"100% 100%",backgroundPosition:"0px 0px",cursor:e.location_type===void 0||e.location_type===X.NULL?"defualt":"pointer"},onClick:async()=>{await ge(e),e.location_type!==void 0&&e.location_type!==X.NULL&&F().close("messagePopup")}},{default:()=>[!_&&s("div",{class:o.content},[s(_e,{direction:"y",scrollbarTrigger:"hover",class:o.scrollWrapper},{default:()=>[e.hidden!==me.HIDDEN&&s("div",{class:o.title},[s(Z,{unit:"rem",remUnit:33.3,mode:"innerHTML",needAddRootFontSize:!1,html:e.publicity_name||e.title},null)]),s("div",{class:o.text,style:{"--notice--text-shadow":e!=null&&e.strokeColor?"".concat(e==null?void 0:e.textStroke,"px ").concat(e==null?void 0:e.textStroke,"px 0 ").concat(e==null?void 0:e.strokeColor,",-").concat(e==null?void 0:e.textStroke,"px ").concat(e==null?void 0:e.textStroke,"px 0 ").concat(e==null?void 0:e.strokeColor,",").concat(e==null?void 0:e.textStroke,"px -").concat(e==null?void 0:e.textStroke,"px 0 ").concat(e==null?void 0:e.strokeColor,",-").concat(e==null?void 0:e.textStroke,"px -").concat(e==null?void 0:e.textStroke,"px 0 ").concat(e==null?void 0:e.strokeColor):"none"}},[s(Z,{class:o.popupContent,unit:"rem",remUnit:33.3,mode:"innerHTML",needAddRootFontSize:!1,html:t.value,vestATagJump:!0},null)])]})]),!(_||v)&&s("div",{class:o.imgIconWrap},[s(q,{src:e.img_icon,class:o.imgIcon},null)]),g.value.length>1&&I.value>0&&s("div",{class:[o.pagePre,o.pageBtn],onClick:f=>l(f,D.PREVIEW)},[s(q,{src:"/lobby_asset/common/web/common/comm_icon_fh.svg"},null)]),g.value.length>1&&I.value<g.value.length-1&&s("div",{class:[o.pageNext,o.pageBtn],onClick:f=>l(f,D.NEXT)},[s(q,{src:"/lobby_asset/common/web/common/comm_icon_fh.svg"},null)])]})};return()=>{var f,W;let e;const t=c.value,a=(t==null?void 0:t.frame_switch)===G.SHOW||(t==null?void 0:t.frameSwitch)===G.SHOW,{setHasTodayNoMorePopup:i}=B();i(a);const _=(t==null?void 0:t.img_style)||w.TEXT_INTRODUCTION,I=(t==null?void 0:t.img_color)||_===w.CUSTOMIZE&&(t==null?void 0:t.img_url),v=Number((W=(f=d==null?void 0:d.commonConfig)==null?void 0:f.windowCss)!=null?W:1),C="layout".concat(v);return s("div",{class:{[o.main]:!0,[o[C]]:!0,[o.buttomBtn]:a}},[s(ie,{class:[o.commonTabs,I?o.backImg:o.noBackImg],navPosition:v===1||v===4?"left":"top",onChange:m=>E(m),active:y.value,"onUpdate:active":m=>y.value=m,shrink:v===1||v===4,key:x.value,lineHeight:0},at(e=g.value.map((m,se)=>s(de,{name:m.key,key:m.key+se+(r.value?m.read_status===U.Unread:!m.read).toString(),title:()=>s("div",{class:[o.tabsItem,"tabsItem"]},[s("span",{class:[[o.icon],(r.value?m.read_status===U.Unread:!m.read)?[o.noRead]:null,"icon"]},[m.icon]),s("div",{class:[o.tabsLabel,"tabsLabel"]},[s("span",{class:o.titleContent},[T(m.value)])])]),content:()=>s(be,null,[t&&ne(t)])},null)))?e:{default:()=>[e]}),a&&s("div",{class:o.agreedBox},[s("div",{class:o.agreedWrap},[s("div",{class:{[o.checkWrapper]:!0}},[s(ue,{modelValue:n.value,"onUpdate:modelValue":m=>n.value=m,onChange:m=>{N(m)}},null)]),s("span",{class:o.tips},[b("lobby.modal.force.main_not_show_again_today")])])])])}}}),ct="_modal_3mhos_17",lt="_hasBtn_3mhos_33",Q={modal:ct,hasBtn:lt},[it]=ee("messagePopup"),St=te({name:it,setup(){const{dialogsStates:{messagePopup:y}}=F();return()=>{const{hasTodayNoMorePopup:E}=B();return s(ve,{show:y.show,"onUpdate:show":S=>y.show=S,class:[Q.modal,E?Q.hasBtn:null],onClose:()=>F().close("messagePopup")},{title:()=>null,default:()=>s(rt,null,null)})}}});export{St as default};
//# sourceMappingURL=MessagePopupIndex.DBsmWLg3.js.map
