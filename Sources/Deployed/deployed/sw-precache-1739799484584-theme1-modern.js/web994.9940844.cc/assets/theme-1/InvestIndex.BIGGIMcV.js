import{l as V,f,p as e,F as te,h as ne,r as P,b9 as oe,y as re,z as le,C as ue}from"../vendors/vendor-@vue.DNlpgob2.js";import{aE as ie,br as ce,bs as ve,a as W,p as me,l7 as T,bq as m,U as K,bN as H,Z as de,t as be,a0 as ye,az as U,E as pe,a6 as _e,Y as $,aB as Z,bV as G,bL as z,ca as L,aa as J,o as fe,bM as ge,w as he,bu as Ie,bQ as q,iX as Re}from"./main.C8q1iJMV.js";import{a as we,E as xe}from"./props.DdPRoj_x.js";import{s as O}from"../vendors/vendor-stable.LD58Pbb3.js";import{u as F}from"./index.BB5bZn2v.js";import{e as Te,d as ee}from"../vendors/vendor-default.CjiYZF7Q.js";import"../vendors/vendor-bignumber.BRr1dcww.js";import"../vendors/vendor-swiper.ZXc-sUCV.js";import{T as De}from"./index.SS2HDjZq.js";import{S as ke}from"./SubscriptCompIndex.CMEe5GR0.js";import{P as Ee}from"./PublicIntroductionIndex.bUl03y0X.js";import{a as Ce}from"./activeReceiveOne.CY32GsDi.js";import"../vendors/vendor-lodash.BYdGDldS.js";import"../vendors/vendor-@sentry.EjpkRnd3.js";import"../vendors/vendor-dom-to-image.C12bjAh8.js";import"../vendors/vendor-@intlify.BmUtFfVu.js";import"./Table.CBQduS50.js";var M=(s=>(s[s.STABLE=0]="STABLE",s[s.RATE=1]="RATE",s))(M||{});const $e=async s=>{var r;const v=await ie.request({url:"/active/investment_handler",method:"post",data:{...s},headers:{deviceModel:ce(),devicetype:ve()}},{cache:{useCache:"fresh",time:60},oss:{enable:!1},error:{action:"silent"}});return(r=v==null?void 0:v.data)==null?void 0:r.data},Ae="_infos_1f02u_17",Se="_value_1f02u_23",Be="_right_1f02u_29",Ne="_yellow_1f02u_33",p={infos:Ae,value:Se,"value-margin":"_value-margin_1f02u_26",right:Be,yellow:Ne,"table-list":"_table-list_1f02u_44"},[ze]=K("event-item-modes-invest-components-invest-detail"),Le=V({name:ze,props:{fetchData:Function},setup(){const{t:s}=W(),{itemErr:v}=O(F()),r=f(()=>{const{eventItemData:u}=O(F());return u.value.activeData}),d=f(()=>{var u,a;return((a=(u=r.value)==null?void 0:u.ruleText)==null?void 0:a.investment_type)===M.RATE}),A=f(()=>[{title:s("lobby.event.invest.columns.investmentAmount.label"),dataIndex:"investment_amount",key:"investment_amount",customRender:u=>{var i;const[a=0,l=0]=(i=u==null?void 0:u.split(","))!=null?i:[];return e("span",{class:["text"]},[d.value?"".concat(m(a,0),"-").concat(m(l,0)):"".concat(m(a,0))])}},{title:"".concat(s("lobby.event.invest.columns.dayRewardRate.label")).concat(d.value?"(%)":""),dataIndex:"day_reward",key:"day_reward",customRender:(u,a)=>e("span",{class:p.yellow},["".concat(d.value?m(a.day_reward_rate)+"%":m(a.day_reward))])},{title:s("lobby.event.invest.columns.rewardDays.label"),dataIndex:"reward_days",key:"reward_days",customRender:()=>{var u,a;return e("span",{class:["text"]},[s("lobby.event.invest.columns.rewardDays.value",{days:(a=(u=r.value)==null?void 0:u.ruleText)==null?void 0:a.reward_days})])}},{title:"".concat(s("lobby.event.invest.columns.totalRewardRate.label")).concat(d.value?"(%)":""),key:"total_reward",customRender:(u,a)=>e("span",{class:p.yellow},["".concat(d.value?a.total_reward_rate+"%":m(a.total_reward))])}]);return me(()=>{v.value&&T.back()}),()=>{var g,I;const{currentProfit:u=0,profitCount:a=0,investmentAmount:l=0,totalProfit:i=0}=r.value||{};return e(te,null,[e("div",{class:[p.infos]},[e("div",null,[e("div",{class:[p.value,p["value-margin"]]},[e("span",{class:"text"},[s("lobby.event.invest.todayData")]),e("span",{class:p.yellow},[m(u)])]),e("div",{class:[p.value]},[e("span",{class:"text"},[s("lobby.event.invest.daysReceived")]),e("span",{class:"text-value"},[a])])]),e("div",{class:p.right},[e("div",{class:[p.value,p["value-margin"]]},[e("span",{class:"text"},[s("lobby.event.invest.investmentAmount")]),e("span",{class:"text-value"},[m(l)])]),e("div",{class:[p.value]},[e("span",{class:"text"},[s("lobby.event.invest.accumulated")]),e("span",{class:p.yellow},[m(i)])])])]),e(De,{class:p["table-list"],columns:A.value,data:(I=(g=r.value)==null?void 0:g.ruleText)==null?void 0:I.rule_list,uniqueKey:"limitTable"},null)])}}}),Oe="_currency_vc3z9_42",Fe="_balance_vc3z9_61",Me="_retry_vc3z9_72",Pe="_active_vc3z9_99",qe="_formItemAmountCurrencySymbol_vc3z9_129",je="_extra_vc3z9_143",x={"invest-modal":"_invest-modal_vc3z9_17",currency:Oe,balance:Fe,retry:Me,"amount-select":"_amount-select_vc3z9_75",active:Pe,"form-item-amount":"_form-item-amount_vc3z9_124",formItemAmountCurrencySymbol:qe,extra:je,"input-amount":"_input-amount_vc3z9_148"},[He]=K("event-item-modes-invest-components-invest-now"),Ue=V({name:He,props:{form:{type:Object,required:!0}},setup(s){var k,N;const{t:v}=W(),r=ne(s.form),{updatePrize:d}=H(),{isFetchingPrize:A}=O(H()),u=f(()=>{var t,c;return(c=(t=U().userInfos)==null?void 0:t.game_gold)!=null?c:0}),a=()=>{T.push({name:pe.CENTER_WALLET})},l=f(()=>{const{eventItemData:t}=F();return t.activeData}),i=f(()=>{var t,c;return((c=(t=l.value)==null?void 0:t.ruleText)==null?void 0:c.investment_type)===M.RATE}),g=((N=(k=l.value)==null?void 0:k.ruleText)==null?void 0:N.rule_list)||[],I=i.value?"%":"",h=f(()=>g.find(t=>t.id===r.ruleId)),E=t=>m(t,2),S=f(()=>{var t,c,b,R;return i.value?v("lobby.modal.pay.placeholder",{a:">".concat(m((c=(t=h.value)==null?void 0:t.investment_amount_start)!=null?c:0)),b:m((R=(b=h.value)==null?void 0:b.investment_amount_end)!=null?R:0)}):""}),D=(t,c=!1)=>{const b=i.value?"".concat(E(t.reward_rate)).concat(I):"".concat(E(t.reward)),R=v("lobby.event.invest.receiveItem1",{range:i.value?"".concat(m(t.investment_amount_start,0),"-").concat(m(t.investment_amount_end,0)):"".concat(E(t.investment_amount))}),n=v("lobby.event.invest.receiveItem2",{gift:c?'<span class="yellow">'.concat(b,"</span>"):"".concat(b)});return c?'<span class="pre">'.concat(R,"</span>").concat(n?'，<span class="end">'+n+"</span>":""):"".concat(R,"，").concat(n)},B=()=>{var c,b;const t=r.amount;if(t&&i.value){const R=(c=g.filter(o=>o.id===r.ruleId)[0])==null?void 0:c.investment_amount_end,n=(b=g.filter(o=>o.id===r.ruleId)[0])==null?void 0:b.investment_amount_start;Number(t)>Number(R)&&(r.amount=R),Number(t)<Number(n)&&(r.amount=n)}};return()=>e("div",{class:x["invest-modal"]},[e("section",{class:x.balance},[e("span",null,[v("lobby.event.invest.balance")]),e("span",{class:x.currency,onClick:a},[E(u.value)]),e(de,{type:"icon",icon:"/lobby_asset/{layout}-{bg}-common/web/common/comm_icon_sx.svg",class:x.retry,loading:A.value,onRetry:d},null)]),e("section",null,[e("div",{class:"amount-top"},[e("span",{class:"title"},[v("lobby.event.invest.amount")])]),e("ul",{class:x["amount-select"]},[g.map(t=>{const c=D(t,!0),b=t.id===r.ruleId;return e("li",{key:t.id,class:{[x.active]:b},onClick:()=>{r.ruleId=t.id,i.value||(r.amount=t.investment_amount)}},[e(be,{html:c},null),b&&e(ke,null,null)])})]),h.value&&e("div",{class:x["form-item-amount"]},[e(ye,{class:x["input-amount"],value:r.amount,"onUpdate:value":t=>r.amount=t,readonly:!i.value,placeholder:S.value,onBlur:B},null),e("div",{class:x.extra},[v("lobby.event.invest.tips")])])])])}}),Ve="_invest_1vku4_17",We="_intro_1vku4_27",w={invest:Ve,intro:We,"active-bottom":"_active-bottom_1vku4_31","bottom-btns":"_bottom-btns_1vku4_42","return-btn":"_return-btn_1vku4_69"};function j(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Object]"&&!ue(s)}const[Ke]=K("event-item-modes-invest"),vt=V({name:Ke,props:{...we,eventId:Number},emits:["marginTypeChange"],setup(s,{emit:v}){const r=F(),{eventItemData:d,isItemLoading:A,itemErr:u}=O(r),{t:a}=W(),l=f(()=>d.value.activeData),i=P(!1),g=P(!1),I=P(T.currentRoute.value.query.isRenderInvestForm||""),h=ne({ruleId:0,amount:void 0});v("marginTypeChange",xe.BOTTOM_BTN);const E=f(()=>A.value?"nested-loading":u.value?"retry":null),S=f(()=>{var n,o;return((o=(n=l.value)==null?void 0:n.ruleText)==null?void 0:o.investment_type)===M.RATE}),D=f(()=>{var n,o;return((o=(n=l.value)==null?void 0:n.ruleText)==null?void 0:o.rule_list)||[]}),B=()=>{var n,o,y;h.ruleId=(n=D.value[0])==null?void 0:n.id,S.value||(h.amount=Number(S.value?(o=D.value[0])==null?void 0:o.investment_amount_start:(y=D.value[0])==null?void 0:y.investment_amount))};I.value&&B();const k=async()=>{s.eventId&&r.refreshEventItemDetail(s.eventId)},N=async()=>{var n,o,y;i.value||!l.value||await z.check({eventData:{},checkOptions:{[L.forbidReceive]:!0}})||(i.value=!0,Ce({params:{receiveId:(o=(n=l.value)==null?void 0:n.investmentId)==null?void 0:o.toString(),activeId:(y=l.value)==null?void 0:y.activeId},judgeResBefore:()=>{i.value=!1,k()},onError:()=>{i.value=!1}}))},t=async()=>{var X,Y;if(g.value||!l.value)return;const{userInfos:n,hasLogined:o}=U(),{updatePrize:y}=H(),{chargeRate:_}=Z(),{openLoginRegister:C}=G();if(!o){C();return}if(await z.check({checkOptions:{[L.task]:!0},eventData:d.value}))return;const ae=(X=n==null?void 0:n.game_gold)!=null?X:0;if(h.amount>ae){const se=J.showDialog({title:()=>a("lobby.notice.importantNotice"),type:"error",message:a("lobby.event.invest.investLimitTips"),showCancelButton:!1,confirmButtonText:a("lobby.event.sign.toRecharge"),showCloseButton:!0,confirmButtonBadgeText:a("lobby.modal.pay.give2",{num:_}),onConfirm:()=>{J.closeDialog(se.instance),fe()}});return}g.value=!0;const[Q]=await Te($e({activeId:(Y=l.value)==null?void 0:Y.activeId,amount:Number(h.amount),ruleId:h.ruleId}));if(g.value=!1,Q){await z.checkRes({config:{err:Q},checkOptions:{[ge.userRestrict]:!0}}),k();return}T.back(),he({type:"success",message:a("lobby.event.invest.investSuccess")}),y(),k(),Ie().getEventCategoriesAndEvents(),Z().freshDiscountRedDot()},c=async()=>{const{hasLogined:n}=U(),{openLoginRegister:o}=G();if(!n){o();return}await z.check({eventData:d.value,checkOptions:{[L.forbidReceive]:!0,[L.receiveType]:!0}})||(B(),I.value="1",T.push({path:T.currentRoute.value.path,query:{...T.currentRoute.value.query,isRenderInvestForm:1}}))},b=()=>{var n,o,y;if(!l.value)return null;if(((n=l.value)==null?void 0:n.status)===q.CanReceive)return e($,{type:"success",class:w["action-btn"],onClick:N,loading:i.value},{default:()=>[e("span",null,[a("lobby.event.invest.receive")])]});if(((o=l.value)==null?void 0:o.status)===q.HasReceive){let _;return e($,{class:w["action-btn"],type:"primary",disabled:!0},j(_=a("lobby.event.invest.received"))?_:{default:()=>[_]})}if(((y=l.value)==null?void 0:y.investmentAmount)===0){let _;const C=ee.unix(d.value.endTime).isBefore(ee());return e($,{class:w["action-btn"],type:"primary",disabled:C,onClick:c},j(_=a("lobby.event.invest.now"))?_:{default:()=>[_]})}return e($,{class:w["action-btn"],disabled:!0,type:"success"},{default:()=>{var _,C;return[((_=l.value)==null?void 0:_.status)===q.Processing?a("lobby.event.invest.receive"):Re((C=l.value)==null?void 0:C.status)]}})},R=()=>{T.back()};return oe(async()=>{var n;(!l.value||((n=l.value)==null?void 0:n.activeId)!==s.eventId)&&(await r.getEventItemDetail(s.eventId),I.value="")}),()=>{let n;return e(_e,{type:E.value,onRetry:k},{default:()=>{var o,y;return[e("div",{class:w.invest},[I.value&&((o=D.value)!=null&&o.length)?e(Ue,{form:h},null):e(Le,null,null)]),e("div",{class:w.intro},[e(Ee,{eventData:d.value},null)]),e("div",{class:w["active-bottom"]},[re(e("div",{class:w["bottom-btns"]},[I.value&&((y=D.value)!=null&&y.length)?e($,{class:w["invest-btn"],type:"primary",disabled:!h.amount,onClick:t},j(n=a("lobby.event.invest.confirm"))?n:{default:()=>[n]}):e(te,null,[e($,{class:w["return-btn"],onClick:R},{default:()=>[e("span",null,[a("lobby.common.tips.return")])]}),b()])]),[[le,!u.value]])])]}})}}});export{vt as default};
//# sourceMappingURL=InvestIndex.BIGGIMcV.js.map
