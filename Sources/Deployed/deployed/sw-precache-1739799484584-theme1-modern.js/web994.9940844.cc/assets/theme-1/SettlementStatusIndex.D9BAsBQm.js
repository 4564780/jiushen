import{B as _}from"./tabs.C8gMd3cQ.js";import{aE as v,a as L,h4 as f,ky as q,u as M,he as F,kC as U,kD as W,gZ as y,ha as c,h7 as I,E as $,kE as D,kF as E,a6 as G,a3 as V,a4 as z,a0 as H,kz as Z,w as Y}from"./main.C8q1iJMV.js";import{h as C}from"../vendors/vendor-default.CjiYZF7Q.js";import{d as j,a as J}from"../vendors/vendor-stable.LD58Pbb3.js";import{f as T,l as K,r as Q,h as X,p as n,F as ee,w as te}from"../vendors/vendor-@vue.DNlpgob2.js";import{I as le}from"./InfoListIndex.sqsON9bW.js";import{M as ae}from"./ModalIndex.BOL5WFtp.js";import{P as oe}from"./PermissionIndex.tJkjHIkl.js";import{R as se}from"./RemarkIndex.DpHXqo9x.js";import{S as ne}from"./StatusTextIndex.5qXfdHIN.js";import"../vendors/vendor-lodash.BYdGDldS.js";import"../vendors/vendor-bignumber.BRr1dcww.js";import"../vendors/vendor-swiper.ZXc-sUCV.js";import"../vendors/vendor-@sentry.EjpkRnd3.js";import"../vendors/vendor-dom-to-image.C12bjAh8.js";import"../vendors/vendor-@intlify.BmUtFfVu.js";const ue=e=>v.request({url:"/api/club/settleOrder/detail",method:"POST",data:{billNo:e}},{crypto:{enable:!0}}),re=e=>v.request({url:"/api/club/settleOrder/settle",method:"POST",data:e},{crypto:{enable:!0}}),ie=e=>v.request({url:"/api/club/margin/dealTypeList",method:"POST",data:e},{crypto:{enable:!0},cache:{useCache:"fresh",setCache:!0}}),be=()=>v.request({url:"/api/club/settleOrder/waitingCount",method:"post"},{crypto:{enable:!0}}),ce=j("club-bill",()=>{const{t:e}=L(),{data:m,execute:h}=f((s=0)=>ie({origin:2,marginType:s}),{immediate:!0}),{data:g,execute:p}=f(be,{immediate:!0}),o=T(()=>{if(!m.value)return[];const s=m.value.map(l=>{var i,d;return{key:(i=l.dealType)!=null?i:"",content:(d=l.dealTypeDesc)!=null?d:""}});return[{key:0,content:e("lobby.club.allBillChangeType")},...s]});return{billChangeType:o,getBillChangeType:h,getBillChangeTypeContent:s=>{if(!s||!o.value.length)return;const l=o.value.find(i=>i.key===s);return l==null?void 0:l.content},pendingCount:g,getPendingCount:p}}),Ie=K({setup(){const{t:e}=L(),m=J(),h=q(),g=ce(),p=Q(),o=X({settleAmount:"",remark:""}),{open:B,dialogsStates:{clubSettlementStatus:s}}=M(),{data:l,placeholderType:i,execute:d}=f(ue),{isLoading:R,error:N,execute:O}=f(re),P=T(()=>{if(!l.value)return[];const t=l.value,r=[{label:e("lobby.club.billDate"),value:F(t.settleStartTime,!1)},{label:e("lobby.club.settlementCycle"),value:U().getContent(t.settlePeriod)},...u.value?[]:[{label:e("lobby.club.billStatus"),value:()=>n(ne,{tag:"b",info:W().get(t.settleStatus)},null)}],{label:e("lobby.club.availableDepositHome"),value:()=>n(ee,null,[n("b",{class:y("text-warning")},[c(t.availableMargin)]),n(oe,{level:"Lv1"},{default:()=>[n("span",{onClick:()=>B("recharge",{openType:"overlay"}),class:y("text-primary ml-20")},[e("lobby.club.recharge")])]})])},{label:e("lobby.club.usedDeposit"),value:c(t.occupiedMargin)},{label:e("lobby.club.currentBill"),value:()=>n("span",{class:[I("link")],onClick:()=>{s.show=!1,m.push({name:$.CLUB_BILL_DETAIL,query:{no:l.value.billNo}})}},[c(t.currentBill)])},{label:e("lobby.club.settled"),value:c(t.settleBill)},{label:e("lobby.club.unSettled"),value:()=>n("b",null,[c(t.unsettleBill)])}];return u.value||r.push({label:e("lobby.club.remark"),value:t.remark}),r}),u=T(()=>l.value&&l.value.settleStatus===1),S=()=>{var t;s.show&&((t=s.options)!=null&&t.billNo)&&d(s.options.billNo)};te(()=>s.show,S,{immediate:!0});const k=async()=>{var r,a;let t;u.value&&(t=C((a=(r=l.value)==null?void 0:r.unsettleBill)!=null?a:0).isLessThan(0)?0:Number(o.settleAmount)),await O({billNo:l.value.billNo,remark:o.remark,settleAmount:t}),N.value||(Y({type:"success",message:e("lobby.club.actionSucessTips.base")}),h.needReloadTabMap[_.Tab.Management]=!0,g.getPendingCount(),s.show=!1)};return D.on(E.PAY_ORDER_SUCCESS_NOTICE,S),D.on(E.WITHDRAW_ORDER_SUCCESS_NOTICE,S),()=>n(ae,{show:s.show,"onUpdate:show":t=>s.show=t,loading:R.value,onClose:()=>{o.settleAmount="",o.remark=""},size:u.value?"normal":"small",title:u.value?e("lobby.club.earlySettlement"):e("lobby.club.settlement"),buttons:l.value?[{text:e("lobby.club.cancel"),plain:!0},{text:u.value?e("lobby.club.confirm"):e("lobby.club.settlement"),closeModalOnClick:!1,onClick:()=>{var t;return u.value?(t=p.value)==null?void 0:t.submit():k()}}]:void 0},{default:()=>[n(G,{type:i.value,empty:{text:e("lobby.event.luckyWheel.tabs.noData")}},{default:()=>[n(le,{list:P.value},null),u.value&&n(V,{ref:p,onSubmit:k,class:[I("form"),y("mt-20")],layout:"vertical"},{default:()=>{var t,r;return[!C((r=(t=l.value)==null?void 0:t.unsettleBill)!=null?r:0).isLessThan(0)&&n(z,{name:"money",required:!0,label:e("lobby.club.earlySettlementAmount"),rules:[a=>a?Number(a)<=0?"".concat(e("lobby.club.earlySettlementAmount")," ").concat(e("lobby.club.errorTips.scoreBelowZero")):!0:"".concat(e("lobby.club.earlySettlementAmount")," ").concat(e("lobby.common.formRules.requiredWithoutItem"))]},{default:()=>[n(H,{value:o.settleAmount,"onUpdate:value":a=>o.settleAmount=a,placeholder:e("lobby.club.placeholder.earlySettlementAmount"),type:"number",ignores:["+","-","e"],onBlur:()=>{var b,x,w,A;let a=o.settleAmount;a&&C(a).isGreaterThan((x=(b=l.value)==null?void 0:b.unsettleBill)!=null?x:0)&&(a=(w=l.value)==null?void 0:w.unsettleBill),o.settleAmount=(A=Z(a))!=null?A:""}},{suffix:()=>n("span",{onClick:()=>{var a,b;o.settleAmount=(b=(a=l.value)==null?void 0:a.unsettleBill)!=null?b:""},class:y("text-primary")},[e("lobby.club.max")])})]}),n(se,{modelValue:o.remark,"onUpdate:modelValue":a=>o.remark=a},null)]}})]})]})}});export{Ie as default};
//# sourceMappingURL=SettlementStatusIndex.D9BAsBQm.js.map
