import{i as c,j as U}from"./enum.CcXhH6KG.js";import{gL as h}from"./main.C8q1iJMV.js";import{e as v}from"../vendors/vendor-default.CjiYZF7Q.js";import{r as y}from"../vendors/vendor-@vue.DNlpgob2.js";function g(a){if(a.data===null)throw new Error;let t;if(typeof a.data=="string"){const r=atob(a.data.split(",")[1]),s=new Array(r.length);for(let l=0;l<r.length;l++)s[l]=r.charCodeAt(l);const p=new Uint8Array(s);t=new Blob([p],{type:a.type})}else t=new Blob([a.data],{type:a.type});return t}function C(a){return new Promise(t=>{const r=new FileReader;r.onload=s=>{var p,l;t({file:{name:a.name,type:a.type,size:a.size,data:(l=(p=s.target)==null?void 0:p.result)!=null?l:""}})},r.readAsDataURL(a)})}const R=()=>{const a=y(0),t=y(c.UPLOADING),r=y(),s=y(),p=e=>{const n=new FormData;if(e instanceof File)n.append("uploadfile",e);else{const u=g(e),i=new File([u],e.name,{type:e.type});n.append("uploadfile",i)}return n},l=async e=>{var f,d;if(e.data===null)throw new Error("File data is null");const n=p(e),[u,i]=await v(h({data:n}));if(!u)return(d=(f=i.data.data)==null?void 0:f.url)!=null?d:""},F=e=>e.type.startsWith("image/")?U.Image:U.Video,m=async e=>{const n=e!=null?e:[];a.value=0,t.value=c.UPLOADING;let u=0;const i=n.map(o=>o.url?(u++,o):l(o.file).then(w=>w?(u++,a.value=u===n.length?100:Math.floor(u/n.length*100),{url:w,type:F(o.file)}):(t.value=c.FAILURE,{url:"",file:o.file,type:F(o.file)}))),d=(await Promise.all(i)).map(o=>({url:o.url,file:o.file,type:o.type}));return t.value===c.FAILURE?s.value=d:(t.value=c.SUCCESS,r.value=d),d};return{uploadProgress:a,uploadStatus:t,uploadedFiles:r,uploadFile:m,reUpload:()=>{var e;m((e=s.value)!=null?e:[])},clearFiles:()=>{t.value=c.UPLOADING,r.value=[],s.value=[]}}};export{g as a,C as c,R as u};
//# sourceMappingURL=useFileUpload.njlonVJS.js.map
