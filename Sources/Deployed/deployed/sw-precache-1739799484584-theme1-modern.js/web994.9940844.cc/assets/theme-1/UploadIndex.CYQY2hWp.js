import{Y as R,W as x,U as O,f6 as D,f7 as P,f8 as E,f9 as W,R as F,I as $,fa as q,w as h,fb as w}from"./main.C8q1iJMV.js";import{Z as Y}from"../vendors/vendor-default.CjiYZF7Q.js";import{b as T}from"../vendors/vendor-stable.LD58Pbb3.js";import"../vendors/vendor-bignumber.BRr1dcww.js";import"../vendors/vendor-swiper.ZXc-sUCV.js";import{l as j,r as c,f as U,w as Z,e as G,p as t,C as H,s as J,F as K}from"../vendors/vendor-@vue.DNlpgob2.js";function k(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!H(a)}const[Q,I]=O("image-cropper"),X=j({name:Q,props:{modelValue:Boolean,imageUrl:{type:String,required:!0},outputImageSize:{type:Number,default:144}},emits:["update:image","update:modelValue","cancel"],setup(a,{emit:m}){const{t:s}=T(),g=c(null),l=c(null),r=U({get(){return a.modelValue},set(o){m("update:modelValue",o)}});Z(()=>a.imageUrl,(o,i)=>{o!==i&&l.value&&l.value.replace(o)});const d=()=>{g.value&&(l.value=new Y(g.value,{aspectRatio:1,viewMode:1,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,dragMode:"move",movable:!0,rotatable:!1,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,cropBoxMovable:!1,cropBoxResizable:!1,toggleDragModeOnDblclick:!1,ready(){console.log("Cropper is ready")}}))};G(()=>{l.value&&l.value.destroy()});const v=()=>{if(l.value){const o=l.value.getCroppedCanvas({width:a.outputImageSize,height:a.outputImageSize});o&&o.toBlob(i=>{if(i){const y=new File([i],"cropped-image.png",{type:i.type,lastModified:Date.now()});m("update:image",y)}})}};return()=>{let o,i;return t(x,{show:r.value,"onUpdate:show":y=>r.value=y,class:I(),onOpened:d,duration:0},{default:()=>[t("div",{class:I("cropper")},[t("img",{ref:g,src:a.imageUrl,alt:"Source Image"},null)]),t("div",{class:I("footer")},[t(R,{plain:!0,type:"primary",class:I("button"),onClick:()=>{m("cancel"),r.value=!1}},k(o=s("lobby.club.cancel"))?o:{default:()=>[o]}),t(R,{type:"primary",class:I("button"),onClick:v},k(i=s("lobby.center.setting.ok"))?i:{default:()=>[i]})])]})}}}),ee={limit:Number,multiple:Boolean,buttonCloseVisible:{type:Boolean,default:!0},maxImageSize:{type:Number,default:D},maxVideoSize:{type:Number,default:P},acceptImage:{type:Boolean,default:!0},acceptVideo:{type:Boolean,default:!1},containerClass:[String,Array,Object],inputId:String,preview:{type:Boolean,default:!0},useCropper:{type:Boolean,default:!1},outputImageSize:{type:Number,default:E},acceptImageTypes:{type:Array,default:()=>W}},[ae,p]=O("upload"),se=j({name:ae,props:ee,emits:["change"],setup(a,{emit:m}){const{t:s}=T(),g=c(null),l=c([]),r=c([]),d=c(!1),v=c(!1),o=J(),i=U(()=>{let e=[];return a.acceptImage&&(e=e.concat(a.acceptImageTypes)),a.acceptVideo&&(e=e.concat(q)),e.join(",")}),y=U(()=>typeof a.limit>"u"?!0:l.value.length<a.limit),L=e=>{r.value=[],l.value=[],e==null||e.forEach(u=>{const n=u.type.startsWith("image/")?"image":"video";r.value.push({type:n,src:URL.createObjectURL(u)}),l.value.push(u)})},z=c(),N=e=>{const u=e.target,n=u.files?u.files[0]:null;if(!n)return;if(!a.acceptImageTypes.includes(n.type)){h({type:"error",message:s("lobby.common.upload.error.fileType")});return}if(a.maxImageSize&&n.size>a.maxImageSize*w){h({type:"error",message:s("lobby.common.upload.error.fileSize")});return}if(a.limit&&l.value.length>=a.limit)return;const b=new FileReader;b.onload=C=>{z.value=C.target.result,d.value=!0},b.readAsDataURL(n)},A=e=>{r.value.push({type:"image",src:URL.createObjectURL(e)}),l.value.push(e),m("change",l.value),z.value=null,d.value=!1},M=e=>{var C;const u=e.target,n=Array.from((C=u.files)!=null?C:[]);if(!(n!=null&&n.length))return;let b=!1;n.forEach(f=>{const S=f.type.startsWith("image/")?"image":"video";if(S==="image"){if(!a.acceptImageTypes.includes(f.type)){h({type:"error",message:s("lobby.common.upload.error.fileType")});return}if(a.maxImageSize&&f.size>a.maxImageSize*w){h({type:"error",message:s("lobby.common.upload.error.fileSize")});return}}if(S==="video"&&a.maxVideoSize&&f.size>a.maxVideoSize*w){h({type:"error",message:s("lobby.common.upload.error.fileSize")});return}a.limit&&l.value.length>=a.limit||(r.value.push({type:S,src:URL.createObjectURL(f)}),l.value.push(f),b=!0)}),b&&m("change",l.value)},_=e=>{a.preview&&(o.value=e,v.value=!0)},V=()=>{v.value=!1},B=e=>{typeof e>"u"?(l.value=[],r.value=[]):(l.value.splice(e,1),r.value.splice(e,1)),m("change",l.value)};return F({clear:B,focus:()=>{var e;(e=g.value)==null||e.click()},handleDefaultFileList:L}),()=>t(K,null,[t("div",{class:[p(),a.containerClass]},[r.value.map((e,u)=>t("div",{key:e.src,class:p("preview-item"),onClick:()=>_(e)},[e.type==="image"?t("img",{src:e.src},null):t("video",{src:e.src},null),a.buttonCloseVisible&&t("span",{class:p("btn-close")},[t($,{onClick:n=>{B(u),n.stopPropagation()},src:"/lobby_asset/common/web/common/comm_icon_x.svg"},null)])])),t("label",{class:p("input",{visible:y.value})},[t("span",{class:p("input-line-h")},null),t("span",{class:p("input-line-v")},null),t("input",{id:a.inputId,ref:g,accept:i.value,type:"file",onChange:a.useCropper?N:M,multiple:!!a.multiple,onClick:e=>{e.target.value=""}},null)])]),t(X,{modelValue:d.value,"onUpdate:modelValue":e=>d.value=e,imageUrl:z.value,"onUpdate:image":A,onCancel:()=>z.value=null,outputImageSize:a.outputImageSize},null),a.preview&&t(x,{show:v.value,"onUpdate:show":e=>v.value=e,class:p("popup-preview")},{default:()=>{var e,u;return[((e=o.value)==null?void 0:e.type)==="image"?t("img",{src:o.value.src,onClick:V},null):t("video",{src:(u=o.value)==null?void 0:u.src,onClick:V},null)]}})])}});export{se as U};
//# sourceMappingURL=UploadIndex.CYQY2hWp.js.map
