import{aE as V,lp as ae,cm as O,U,b as re,az as q,bV as G,bL as K,ca as z,a3 as ce,a4 as ie,lq as k,cr as le,a0 as ue,Y as ve,eM as me,fI as D,w as P,bs as de,bM as pe,cH as Y,lr as fe,cg as ge,I as S,t as be,ls as he,cf as ye,hE as _e,p as Te,a6 as we,q as Ce,lt as Ee,fc as xe,aG as Se,lu as $,eH as j,eK as Re,lv as A,lw as Ie,lx as Ne}from"./main.C8q1iJMV.js";import{E as ze}from"./props.DdPRoj_x.js";import{d as ke,b as X,s as C,u as Me}from"../vendors/vendor-stable.LD58Pbb3.js";import{e as Z,d as Be,v as Fe}from"../vendors/vendor-default.CjiYZF7Q.js";import{r as h,f as y,l as R,p as o,v as Oe,C as J,h as De,F as Q,x as Pe,D as L,n as H}from"../vendors/vendor-@vue.DNlpgob2.js";import{u as I}from"./index.BB5bZn2v.js";import"../vendors/vendor-bignumber.BRr1dcww.js";import"../vendors/vendor-swiper.ZXc-sUCV.js";import"../vendors/vendor-lodash.BYdGDldS.js";import"../vendors/vendor-@sentry.EjpkRnd3.js";import"../vendors/vendor-dom-to-image.C12bjAh8.js";import"../vendors/vendor-@intlify.BmUtFfVu.js";const $e=(s,l,e)=>V.request({url:"/active/request_reward",method:"post",data:{activeId:s,answers:l,requestDeviceType:e}}),je=s=>V.request({url:s,method:"get"},{crypto:{enable:!1},error:{action:"silent",checkResCode:!1}}),ee=ke("customizeState",()=>{const s=h(""),l=h({}),e=y(()=>ae()),v=h(!1),a=h(null);return{isPreview:e,setIsPreview:c=>{l.value=c},iframeContext:s,previewData:l,iframeContextErr:a,getCustomEventDetail:async c=>{v.value=!0;const[i,n]=await Z(je(c));if(a.value=i,i){v.value=!1;return}s.value=n.data,v.value=!1},setPreviewData:c=>{l.value=c},fetchIframeContextLoading:v}}),Ae="_receiveDiscount_b46bu_17",Le="_btnsWrap_b46bu_29",He="_receiveTimes_b46bu_39",We="_formModal_b46bu_51",E={receiveDiscount:Ae,btnsWrap:Le,receiveTimes:He,formModal:We};function W(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Object]"&&!J(s)}const[Ve]=U("event-item-modes-customize-receive-button"),Ue=R({name:Ve,emits:["isReceiveFetching"],setup(s,{emit:l}){const{t:e}=X(),v=I(),a=re(),{eventItemData:t}=C(v),m=h(!1),r=y(()=>t.value.activeData),c=y(()=>{const n=Be().unix(),{startTime:p,endTime:f}=t.value,u=Number(p)>0,g=Number(f)>0;return!u&&!g||u&&!g&&Number(p)<=n||g&&!u&&Number(f)>=n||u&&g&&Number(p)<=n&&Number(f)>=n}),i=async()=>{var p,f;if(!q().hasLogined){G().openLoginRegister({login:!0});return}const n={receiveDeviceType:(p=t.value)==null?void 0:p.receiveDeviceType,taskCondition:(f=t.value)==null?void 0:f.taskCondition};await K.check({eventData:n,checkOptions:{[z.forbidReceive]:!0,[z.receiveType]:!0,[z.task]:!0}})||m.value||(m.value=!0,l("isReceiveFetching",!0))};return()=>{var f,u;let n,p;return o("div",{class:E.receiveDiscount},[o("p",{class:E.receiveTimes},[e("lobby.event.receiveTimes"),Oe("ï¼š"),o("span",null,[(f=r==null?void 0:r.value)==null?void 0:f.requestTimes])]),o("div",{class:E.btnsWrap},[o(O,{onClick:()=>a.back(),type:"primary",plain:!0,class:E.btn},W(n=e("lobby.common.tips.return"))?n:{default:()=>[n]}),o(O,{class:E.btn,onClick:i,disabled:((u=r==null?void 0:r.value)==null?void 0:u.requestTimes)<=0||!c.value,loading:m.value,type:"primary"},W(p=e("lobby.modal.task.receiveDiscount"))?p:{default:()=>[p]})])])}}}),qe="_receiveForm_1rae0_17",Ge="_receiveBtn_1rae0_37",M={receiveForm:qe,"btn-container":"_btn-container_1rae0_25",receiveBtn:Ge};function Ke(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Object]"&&!J(s)}const[Ye]=me("event-item-modes-customize-receive-form"),Xe=R({name:Ye,props:{instance:{type:Object,default:null}},setup(s){const{t:l}=X(),{query:e}=Me(),v=I(),a=De({}),t=h(),m=h(!1),{eventItemData:r}=C(v),c=y(()=>r.value.activeData),i=y(()=>c.value.questions),n=y(()=>Object.keys(a).map(u=>({id:Number(u),answer:a[u]}))),p=y(()=>{const u=Object.keys(a).length;return(i==null?void 0:i.value.length)!==u||u===0?!0:Object.keys(a).some(g=>a[g]==="")}),f=async()=>{var T,x;if(!q().hasLogined){D.closeDialog(s.instance),G().openLoginRegister({login:!0});return}const u=r==null?void 0:r.value;if(await((T=t.value)==null?void 0:T.validate()),n.value.length<i.value.length)return P({type:"error",message:l("lobby.modal.task.receiveDiscountRequired")});m.value=!0;const g=de(),[b]=await Z($e(Number(u==null?void 0:u.id),n.value,Number(g)));if(m.value=!1,b){await K.checkRes({config:{err:b,backupErrMsg:l("lobby.event.collectWords.syntheticFailed"),mute:!0},checkOptions:{[pe.userRestrict]:!0}});return}P({type:"success",message:l("lobby.modal.task.receiveDiscountSuccess")}),D.closeDialog(s.instance),(x=t.value)==null||x.resetForm(),await v.refreshEventItemDetail(Number(e.eventId))};return()=>{let u;return o(Q,null,[o(ce,{class:M.receiveForm,layout:"vertical",ref:t,model:a},Ke(u=i.value.map(g=>o(ie,{required:!0,name:String(g.id),label:g.question},{default:()=>[[k.CATEGORY,k.PLATFORM].some(b=>b===g.systemType)?o(le,{modelValue:a[String(g.id)],"onUpdate:modelValue":b=>a[String(g.id)]=b,options:(g.systemType===k.CATEGORY?c.value.categories:c.value.platforms).map(b=>({value:b,label:b}))},null):o(ue,{value:a[String(g.id)],"onUpdate:value":b=>a[String(g.id)]=b,maxlength:100,placeholder:l("lobby.event.questionPlaceholder")},null)]})))?u:{default:()=>[u]}),o("div",{class:M["btn-container"]},[o(ve,{class:M.receiveBtn,loading:m.value,onClick:f,type:"primary",disabled:p.value},{default:()=>[!m.value&&l("lobby.event.receiveBtn")]})])])}}}),Ze=s=>s.replace(/(border(-width)?):\s1px/g,(l,e)=>"".concat(e,": thin")),Je=s=>s.replace(/(border(-width)?):\sthin/g,(l,e)=>"".concat(e,": 1px"));function Qe(s=[],l=Fe()){const e=v=>a=>s.reduce((t,{tag:m,attributes:r})=>(r.forEach(c=>{const i="data-".concat(c,"-").concat(l),n=v==="replace"?c:i,p=v==="replace"?i:c,f=new RegExp("(<".concat(m,"[^>]*?)\\s+").concat(n,"="),"g");t=t.replace(f,"$1 ".concat(p,"="))}),t),a);return{replace:e("replace"),restore:e("restore")}}const et=(s,l=750)=>{const e=document.createElement("div"),v=[{tag:"img",attributes:["src"]},{tag:"source",attributes:["srcset"]}],{replace:a,restore:t}=Qe(v);e.innerHTML=a(s||"");const m=750,r=c=>{const i=c;if(i.getAttribute){const n=i.getAttribute("style");n&&i.setAttribute("style",Je(Ze(n).replace(/(\d*\.?\d+)px/g,p=>{const f=Number(parseFloat(p));return isNaN(f)?"":Y(l/m*f)})))}for(const n of Array.from(c.childNodes))r(n)};return r(e),t(e.innerHTML||"")},tt={"customize-box":"_customize-box_1m8an_17","bg-color-style-2":"_bg-color-style-2_1m8an_22","customize-head":"_customize-head_1m8an_22","customize-footer":"_customize-footer_1m8an_25"},st=["128","025","033","105","5002"],[ot]=U("event-item-modes-customize-rich-text-box"),nt=R({name:ot,setup(){const s=I(),{eventItemData:l}=C(s),e=ee(),{isPreview:v,previewData:a}=C(e),t=y(()=>v!=null&&v.value?a==null?void 0:a.value:l.value.activeData),m=h(null),r=()=>{var c;m.value&&((c=t==null?void 0:t.value)!=null&&c.isNewStyle)&&he(m.value,!0)};return Pe(r),()=>{const{htmlContent:c,bgColorStyle:i=fe.System}=t.value,n=ge().siteCode,p=st.includes(String(n));return r(),o("div",{ref:m,class:[tt["customize-box"],"bg-color-style-".concat(i)]},[o("div",{class:"customize-head-height-box"},[o(S,{tag:"div",src:t==null?void 0:t.value.customTopImg,class:"customize-head"},{default:()=>[o(S,{tag:"div",src:t==null?void 0:t.value.textureVal,class:"customize-head-bg"},null)]})]),o(be,{tag:"div",class:"cusomize-content ".concat(p?"is-black":""),html:et(c||"")},null),o("div",{class:"customize-footer-height-box"},[o(S,{tag:"div",src:t==null?void 0:t.value.customBottomImg,class:"customize-footer"},{default:()=>[o(S,{tag:"div",src:t==null?void 0:t.value.textureVal,class:"customize-footer-bg"},null)]})])])}}}),at="_placeHolder_3wjvc_17",rt="_previewModePlaceHolder_3wjvc_23",ct="_main_3wjvc_27",it="_content_3wjvc_32",lt="_con1_3wjvc_36",ut="_customizeContainer_3wjvc_40",vt="_previewMode_3wjvc_23",mt="_adapterWrap_3wjvc_50",w={placeHolder:at,previewModePlaceHolder:rt,main:ct,content:it,con1:lt,customizeContainer:ut,previewMode:vt,adapterWrap:mt},[dt]=Ce("event-item-modes-customize"),St=R({name:dt,props:{pageType:{type:Number,default:ye.Normal},eventId:Number},emits:["marginTypeChange","eventsBarShow"],setup(s,{emit:l}){const e=h(),v=h(),a=h(),t=h(!1),m=h(!1),r=h(!1),c=I(),{eventItemData:i,isItemLoading:n,itemErr:p}=C(c),f=ee(),{iframeContext:u,fetchIframeContextLoading:g,iframeContextErr:b,isPreview:T}=C(f),x=async()=>{s.eventId&&c.refreshEventItemDetail(s.eventId)},_=y(()=>i.value.activeData),N=y(()=>{var d;return T.value||((d=_.value)==null?void 0:d.isNewStyle)});l("marginTypeChange",ze.CUSTOMIZE_BOTTOM_BTN);const te=y(()=>n!=null&&n.value||g.value?"loading":m.value?"nested-loading":(p.value||b.value)&&!T.value?"retry":null),B=y(()=>{var d;return i.value.template===j.Customize&&!!((d=_==null?void 0:_.value)!=null&&d.requestType)&&Re(Number(i.value.giveType))}),se=()=>{m.value=!1,H(()=>{if(a.value&&v.value){const{height:d}=a.value.getBoundingClientRect();v.value.style.height="".concat(d*$,"px"),setTimeout(()=>{t.value=!1},1e3)}})},oe=d=>{f.setPreviewData({...d,htmlContent:Ne(String(d==null?void 0:d.htmlContent))}),H(()=>{e!=null&&e.value&&A(d,e==null?void 0:e.value)})},ne=d=>{r.value=d,r.value&&l("eventsBarShow",!1)};return _e("EVENT_CUSTOMIZE_MOCK_PREVIEW",oe),Te(()=>{T.value&&Ee()}),L(()=>{e!=null&&e.value&&(_!=null&&_.value)&&A(_==null?void 0:_.value,e==null?void 0:e.value)}),L(()=>{var d,F;((d=i.value)==null?void 0:d.template)===j.Customize&&((F=i.value)!=null&&F.content&&!N.value&&!r.value?(m.value=!0,t.value=!0,f.getCustomEventDetail(i.value.content)):(b.value=null,m.value=!1))}),()=>o(we,{onRetry:x,class:{[w.placeHolder]:!0,[w.previewModePlaceHolder]:T.value},type:te.value},{default:()=>{var d;return[o("div",{ref:e,class:{[w.main]:!0,[w.customizeContainer]:N.value,[w.previewMode]:T,[w.receiveDiscount]:B.value}},[!r.value&&o(Q,null,[o("div",{class:w.content},[N.value?o(nt,null,null):o("div",{ref:v,class:w.adapterWrap},[o("div",{ref:a},[o(xe,{unit:"px",isSetATargetTop:!0,scrolling:"no",mode:"iframeDoc",html:u.value,unitTransformConfig:{open:!1},useWindowOpen:!!((d=Se)!=null&&d.package.isApp),scaleStyle:{width:Y(Ie),transform:"scale(".concat($,")")},loaded:se},null)])])]),B.value&&o(Ue,{onIsReceiveFetching:ne},null)]),r.value&&o(Xe,null,null)])]}})}});export{St as default};
//# sourceMappingURL=CustomizeIndex.DN4xwkPr.js.map
