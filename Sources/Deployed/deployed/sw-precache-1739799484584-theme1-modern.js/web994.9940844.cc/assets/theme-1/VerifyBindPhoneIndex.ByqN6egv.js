import{a as E,gg as I,az as U,fK as x,g3 as A,hC as j,go as z,bY as g,fP as S,Y as F,aa as H,q as M,hZ as R,h_ as Y,h$ as q,g8 as K,g9 as Z}from"./main.C8q1iJMV.js";import{S as $}from"./Setting.CRobMkOU.js";import{S as G}from"./Steps.B3IX-idj.js";import{D as J,e as h}from"../vendors/vendor-default.CjiYZF7Q.js";import"../vendors/vendor-bignumber.BRr1dcww.js";import"../vendors/vendor-swiper.ZXc-sUCV.js";import{l as L,r as _,f as Q,p as i,C as T}from"../vendors/vendor-@vue.DNlpgob2.js";import"../vendors/vendor-lodash.BYdGDldS.js";import"../vendors/vendor-stable.LD58Pbb3.js";import"../vendors/vendor-@intlify.BmUtFfVu.js";import"../vendors/vendor-@sentry.EjpkRnd3.js";import"../vendors/vendor-dom-to-image.C12bjAh8.js";const W="_verifyBindPhoneDialog_1xdvy_17",X="_verifyBindPhone_1xdvy_17",ee="_submit_1xdvy_20",m={verifyBindPhoneDialog:W,verifyBindPhone:X,submit:ee};function oe(n){return typeof n=="function"||Object.prototype.toString.call(n)==="[object Object]"&&!T(n)}const[se]=M("pages-dialogs-verify-bind-phone"),me=L({name:se,setup(){const{t:n}=E(),u=J(),l=_(!1),v=I(),d=U(),y=x(),{enableUsingSms:B}=A(),{visible:b,openOptions:c,onDialogOpen:C,closeDialog:P}=j("verifyBindPhone"),a=_(""),V=async()=>{var o,s;if(a.value=(s=(o=c.value)==null?void 0:o.desensitizedPhoneNumber)!=null?s:v.value.mobile_phone,!a.value){const[,e]=await h(R());e!=null&&e.phone&&(a.value=e.phone)}};C(async()=>{await V()});const f=Q(()=>{const{code:o,phone:s,source:e}=y.parser(a.value);return!o||!s?{desc:void 0,placeholder:void 0,lockAreaCode:void 0}:{desc:e,lockAreaCode:o,placeholder:z(s)}}),w=async()=>{var t;if(!(await u.validate()).valid||l.value)return;const s={phone:y.format(u.values.phone),captcha:u.values.phoneCode,scene:(t=c.value)==null?void 0:t.verifyScene};l.value=!0,await(a.value?D:N)(s),l.value=!1},D=async o=>{var e,t;const[s]=await h(Y(o));s||((t=(e=c.value)==null?void 0:e.onSuccess)==null||t.call(e),P("verifyBindPhone"))},N=async o=>{var e,t;const[s]=await h(q(o));if(!s){const p=K(o.phone);d.updateUserInfos({mobile_phone:p});const r=d.userInfos;if(r){const{Verified:k,NotVerify:O}=Z;r.mobile_phone=p,r.permissionOpt.hasPhone=!!p,r.is_verified=o.captcha&&B.value?k:O,d.setUserInfos(r)}(t=(e=c.value)==null?void 0:e.onSuccess)==null||t.call(e),P("verifyBindPhone")}};return()=>{let o;return i(H,{show:b.value,"onUpdate:show":s=>b.value=s,class:m.verifyBindPhoneDialog},{default:()=>[i("div",{class:m.verifyBindPhone},[i(G,{title:n("lobby.common.components.auth.phone.title"),step:0,steps:[n("lobby.modal.forgotPassword.step1"),n("lobby.modal.forgotPassword.step3")]},null),i($,{active:g.PHONE,other:{visible:!1},attrs:{[g.PHONE]:{createVerify:{type:"account",value:v.value.platfromid},desc:f.value.desc,attrs:{phone:{placeholder:f.value.placeholder,lockAreaCode:f.value.lockAreaCode},code:{createMode:a.value?S.Verify:S.Bind}}}}},null),i("div",{class:m.submit},[i(F,{type:"primary",block:!0,onClick:w,loading:l.value},oe(o=n("lobby.common.tips.confirm"))?o:{default:()=>[o]})])])]})}}});export{me as default};
//# sourceMappingURL=VerifyBindPhoneIndex.ByqN6egv.js.map
