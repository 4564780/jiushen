import{r as A,a5 as G,o as F,g as Q,f as j,l as q,p as a,F as N,T as Y,y as W,z as Z,C as J}from"../vendors/vendor-@vue.DNlpgob2.js";import{dO as z,e6 as H,e2 as w,dP as X,ea as ee,dQ as B,kb as te,eh as le,kc as V,a as se,hC as ae,v as oe,B as re,em as ne,a0 as ie,gw as ce,I as ue,cs as de,a6 as pe,as as fe,Y as R,W as ge,q as ye,kd as Se,a7 as he,a1 as P}from"./main.C8q1iJMV.js";import{e as me}from"../vendors/vendor-default.CjiYZF7Q.js";import{l as Le,d as ve,c as E,a2 as D,a3 as _e}from"../vendors/vendor-lodash.BYdGDldS.js";import{C as be,a as Ae}from"./index.4KOhFRoM.js";import"../vendors/vendor-bignumber.BRr1dcww.js";import"../vendors/vendor-swiper.ZXc-sUCV.js";import"../vendors/vendor-stable.LD58Pbb3.js";import"../vendors/vendor-@intlify.BmUtFfVu.js";import"../vendors/vendor-@sentry.EjpkRnd3.js";import"../vendors/vendor-dom-to-image.C12bjAh8.js";const U=t=>{var n,g,m,i;const{marketKey:h}=z(),{focusOnListMap:d}=H(),o=(n=t.liveGameCount)!=null?n:0,r=(g=t.gameCount)!=null?g:0,s={[w.Today]:()=>o+r,[w.Rolling]:()=>o,[w.FocusOn]:()=>{const L=d[t.sportType];return!L||!L.length?0:L.filter(y=>y.leagueId===t.leagueId).length}};return(i=(m=s[h])==null?void 0:m.call(s))!=null?i:r};function ke(t){const h=z(),d=H(),o=X(),r=A(),s=A(),n=A(),g=G(s),m=G(n),{getLeagueQuery:i}=ee(),L=A(!0),y=A(!1),I=S=>{d.allLeaguesMap=h.sportList.reduce((p,_)=>{const e=_.sportType,l=d.selectedListMap[e];return p[e]={list:(Le(S.filter(c=>e===c.sportType),"leagueId")||[]).map(c=>{var f;return{...c,isSelected:((f=l==null?void 0:l.leagueIds)!=null?f:[]).includes(c.leagueId),isHide:!1}}),isSelectedAll:(l==null?void 0:l.selectStatus)===V.All},p},{}),d.allLeaguesSportKeyList=h.sportList.filter(p=>!!d.allLeaguesMap[p.sportType]).map(p=>p.sportType)},x=async()=>{var _,e;L.value=!0;const[S,p]=await me(te({...le(h.marketKey),query:i()}));if(L.value=!1,S){y.value=!0;return}y.value=!1,I((e=(_=p==null?void 0:p.data)==null?void 0:_.leagues)!=null?e:[])};let k;F(()=>{k=Q()});const T=()=>{var p,_,e;const S=(p=k==null?void 0:k.ctx.$refs)==null?void 0:p["item".concat(h.sportKey)];if(!S){t.value=d.allLeaguesSportKeyList.slice(0,1);return}t.value=[h.sportKey],(e=r.value)==null||e.scrollTo({y:((_=S==null?void 0:S.$el)==null?void 0:_.offsetTop)-m.height.value})},K=async()=>{await B().guideLoginSport(),await x(),T()},C=j(()=>o.isLoginError?"empty":L.value?"nested-loading":o.isAuthError||y.value?"retry":Object.values(d.allLeaguesMap).every(S=>S.list.every(p=>p.isHide))?"empty":null);return{activeSports:t,root:r,headerRef:s,searchRef:n,headerRect:g,openedHandler:K,placeholderType:C,retryHandler:async()=>{L.value=!0,B().sportAuthErrorHandler({loginType:"onlySport",onLogin:async()=>{await x(),T()}})}}}function Ce(t){const h=z(),d=H(),o=A(""),r=ve(()=>{const s=o.value.trim(),n=E(d.allLeaguesMap);d.allLeaguesMap=D(n,m=>{const i=[];m==null||m.list.forEach(y=>{const I=y.leagueName.toLocaleLowerCase().includes(s.toLocaleLowerCase());i.push({...y,isHide:!I})});const L=i.filter(y=>!y.isHide);return{list:i,isSelectedAll:L.every(y=>y.isSelected),isHideAll:!L.length}}),d.setSelectedAllValue();const{allLeaguesSportKeyList:g}=d;t.value=s.length?g:g.includes(h.sportKey)?[h.sportKey]:g.slice(0,1)},500);return{searchValue:o,searchHandler:r}}function Ie(){const t=H();return{selectAllHandler:()=>{const r=!t.isSelectedAll,s=E(t.allLeaguesMap);t.allLeaguesMap=D(s,n=>{const g=[];n==null||n.list.forEach(i=>{g.push({...i,isSelected:i.isHide?i.isSelected:r})});const m=g.filter(i=>!i.isHide);return{list:g,isSelectedAll:m.every(i=>i.isSelected),isHideAll:!m.length}}),t.isSelectedAll=r},selectAllLeagues:(r,s)=>{s.list.forEach(n=>{n.isHide||(n.isSelected=r)}),t.setSelectedAllValue()},selectLeagueItem:(r,s)=>{!r&&s.isSelectedAll?s.isSelectedAll=!1:r&&s.list.filter(n=>!n.isHide).every(n=>n.isSelected)&&!s.isSelectedAll&&(s.isSelectedAll=!0),t.setSelectedAllValue()}}}const v={"league-filter":"_league-filter_8khyz_17","filter-search":"_filter-search_8khyz_21","search-icon":"_search-icon_8khyz_40","filter-box":"_filter-box_8khyz_47","filter-placeholder":"_filter-placeholder_8khyz_52","collapse-list":"_collapse-list_8khyz_55","list-item":"_list-item_8khyz_63","checkbox-indeteminate":"_checkbox-indeteminate_8khyz_63","list-item-line":"_list-item-line_8khyz_77","line-name":"_line-name_8khyz_88","line-count":"_line-count_8khyz_92","filter-footer":"_filter-footer_8khyz_96"};function $(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!J(t)}const[Te]=ye("pages-dialogs-sport-league-filter"),Be=q({name:Te,setup(){const{t}=se(),h=Se(),d=z(),o=H(),r=A([]),{searchValue:s,searchHandler:n}=Ce(r),{selectAllHandler:g,selectAllLeagues:m,selectLeagueItem:i}=Ie(),{root:L,headerRef:y,searchRef:I,headerRect:x,openedHandler:k,placeholderType:T,retryHandler:K}=ke(r),{visible:C,onDialogClose:O}=ae("sportLeagueFilter");O(()=>{s.value="",o.allLeaguesMap={},o.allLeaguesSportKeyList=[],o.isSelectedAll=!1});const S=j(()=>Object.values(o.allLeaguesMap).reduce((e,l)=>{var c;return e+((c=l==null?void 0:l.list)!=null?c:[]).filter(f=>f.isSelected&&!f.isHide).reduce((f,b)=>f+U(b),0)},0)),p=()=>{if(C.value=!1,o.isSelectedAll&&!s.value.trim()){o.selectedListMap={};return}const e={};if(o.allLeaguesSportKeyList.forEach(c=>{const f=o.allLeaguesMap[c],b=f.list.filter(u=>!u.isHide&&u.isSelected);b.length&&(e[c]={sportType:c,leagueIds:b.map(u=>u.leagueId),selectStatus:_e(b,f.list,"leagueId")?V.Some:V.All})}),!e[d.sportKey]){const c=o.allLeaguesSportKeyList.find(f=>!!e[f]);c&&(d.sportKey=c)}o.selectedListMap=E(e)},_=e=>{var f,b;const l=(f=o.allLeaguesMap)==null?void 0:f[e],c=((b=l==null?void 0:l.list)!=null?b:[]).filter(u=>!u.isHide);return c.length?a(Ae,{ref:"item".concat(e),name:e,title:c[0].sportName,class:v["list-item"],key:e},{icon:()=>a(he,{direction:r.value.includes(e)?"up":"down"},null),"right-icon":()=>a(P,{modelValue:l.isSelectedAll,"onUpdate:modelValue":u=>l.isSelectedAll=u,class:{[v["checkbox-indeteminate"]]:!1},onClick:u=>{u.stopPropagation()},onChange:u=>m(u,l)},null),default:()=>c.map(u=>a("div",{class:v["list-item-line"],key:u.leagueId},[a("span",{class:v["line-name"]},[u.leagueName]),a("span",{class:v["line-count"]},["(".concat(U(u),")")]),a(P,{modelValue:u.isSelected,"onUpdate:modelValue":M=>u.isSelected=M,onChange:M=>i(M,l)},null)]))}):null};return()=>a(ge,{show:C.value,"onUpdate:show":e=>C.value=e,position:"right",class:v["league-filter"],closeOnClickOverlay:!1,onOpened:k},{default:()=>[a(oe,null,{header:()=>{let e;return a(re,{ref:y,onBack:()=>C.value=!1},$(e=t("lobby.selfoperatedGames.sports.filterLeague"))?e:{default:()=>[e]})},default:()=>{let e;return a(N,null,[a(ne,{offsetTop:x.height.value,zIndex:h},{default:()=>[a("div",{class:v["filter-search"],ref:I},[a(ie,{value:s.value,"onUpdate:value":l=>s.value=l,clearable:!0,placeholder:t("lobby.selfoperatedGames.sports.inputLeagueName"),onChange:n,onClear:n},{suffix:()=>a(N,null,[a(ce,{onPaste:l=>s.value=l.trim()},null),a(ue,{class:v["search-icon"],src:"/lobby_asset/common/web/selfoperated-games/icon_ty_ss.svg",useSkeleton:!0},null)])})])]}),a(de,{ref:L,class:v["filter-box"]},{default:()=>[a(pe,{class:v["filter-placeholder"],type:T.value,empty:{text:t("lobby.selfoperatedGames.sports.noEventsYet")},onRetry:K},{default:()=>[a(be,{modelValue:r.value,"onUpdate:modelValue":l=>r.value=l,class:v["collapse-list"]},$(e=o.allLeaguesSportKeyList.map(l=>_(l)))?e:{default:()=>[e]})]})]})])},footer:()=>a(Y,{appear:!0,name:fe.SlideUp},{default:()=>[W(a("div",{class:v["filter-footer"]},[a(R,{size:"large",plain:!0,clearBackground:!0,type:"primary",onClick:g},{default:()=>[o.isSelectedAll?t("lobby.selfoperatedGames.sports.cancleAll"):t("lobby.selfoperatedGames.sports.selectAll")]}),a(R,{size:"large",type:"primary",disabled:!S.value,onClick:p},{default:()=>[t("lobby.selfoperatedGames.sports.confirm"),!!S.value&&"(".concat(S.value,")")]})]),[[Z,!T.value]])]})})]})}});export{Be as default};
//# sourceMappingURL=SportLeagueFilterIndex.DVMiEMYn.js.map
