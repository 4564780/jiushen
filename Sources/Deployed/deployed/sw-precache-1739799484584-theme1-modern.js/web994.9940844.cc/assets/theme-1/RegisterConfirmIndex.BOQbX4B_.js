import{h as B,o as z,w as H,n as V,l as K,r as h,f as E,p as e,v as G,y as Y,z as J,F as Q,C as X}from"../vendors/vendor-@vue.DNlpgob2.js";import{a as L,L as S,hD as Z,aK as ee,w as oe,hC as se,bV as te,D as ae,F as le,hE as ie,hF as ne,aL as re,I as T,fM as ue,dM as ce,Y as A,fI as me,q as de,hG as N,r as ge,g5 as ve,g$ as fe}from"./main.C8q1iJMV.js";import{a0 as be,D as pe,d as _e}from"../vendors/vendor-default.CjiYZF7Q.js";import"../vendors/vendor-bignumber.BRr1dcww.js";import"../vendors/vendor-swiper.ZXc-sUCV.js";import{d as we}from"../vendors/vendor-dom-to-image.C12bjAh8.js";import{U as ye}from"./Username.LtKw3882.js";import{c as O}from"../vendors/vendor-lodash.BYdGDldS.js";import"../vendors/vendor-stable.LD58Pbb3.js";import"../vendors/vendor-@intlify.BmUtFfVu.js";import"../vendors/vendor-@sentry.EjpkRnd3.js";function he(d){const{t:R}=L(),g=B({value:"",loading:!1}),v=B({value:"",loading:!1}),D=n=>typeof n=="string"?document.querySelector(n):n==null?void 0:n.value,s=()=>(g.loading=!0,g.value="",new Promise(n=>{V(async()=>{try{const t=D(d.colorSelector);t?g.value=window.getComputedStyle(t).backgroundColor:S.warn("【dom-to-image】initColor not element",d.colorSelector)}catch(t){S.error("【dom-to-image】initColor",t)}setTimeout(()=>{g.loading=!1,n(null)})})}));z(s);const w=async()=>(v.loading=!0,v.value="",new Promise(n=>{V(async()=>{var b;const t=D(d.buildSelector);if(t)try{v.value=await we.toPng(t,{cacheBust:!0,quality:.8,bgcolor:(b=g.value)!=null?b:void 0})}catch(r){S.error("【dom-to-image】buildImage",r)}else S.warn("【dom-to-image】buildImage not element",d.buildSelector);v.loading=!1,n(null)})}));H(()=>[g.value,d.preBuildDeps],()=>w(),{immediate:!0,deep:!0});const P=(n,t,b=!1)=>{const r=document.createElement("a");if(b){const _=window.atob(n.split(",")[1]),l=n.split(",")[0].split(":")[1].split(";")[0],p=new Uint8Array(_.length);for(let y=0;y<_.length;y++)p[y]=_.charCodeAt(y);const U=new Blob([p],{type:l});r.href=URL.createObjectURL(U)}else r.href=n;r.download=t,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)},k=async(n,t)=>new Promise(b=>{V(async()=>{if(g.loading||v.loading)return await Z(),await k(n);g.value||await s(),v.value||await w(),v.value?(ee().isIos?be.saveAs(v.value,"".concat(n,".png")):P(v.value,"".concat(n,".png")),d.showToast!==!1&&oe({type:"success",message:()=>R("lobby.promote.promote.downloadSuccessTips"),onClose:()=>t==null?void 0:t()})):S.error("【dom-to-image】saveImage not base64 Image"),b(null)})});return{color:g,image:v,download:P,initColor:s,preBuildImage:w,saveImage:k}}const Ie="_registerConfirmDialog_iuvx5_17",Ce="_registerConfirm_iuvx5_17",xe="_imageWrap_iuvx5_24",Se="_title_iuvx5_27",Te="_subTitle_iuvx5_35",Re="_success_iuvx5_42",De="_infoText_iuvx5_47",Pe="_showInfo_iuvx5_51",ke="_showItem_iuvx5_58",Ee="_icon_iuvx5_66",Ae="_label_iuvx5_69",Fe="_info_iuvx5_47",Ue="_edit_iuvx5_78",Ve="_copyText_iuvx5_92",$e="_left_iuvx5_100",Be="_image_iuvx5_24",Ge="_right_iuvx5_109",Ne="_buttons_iuvx5_112",a={registerConfirmDialog:Ie,registerConfirm:Ce,imageWrap:xe,title:Se,subTitle:Te,success:Re,infoText:De,showInfo:Pe,showItem:ke,icon:Ee,label:Ae,info:Fe,edit:Ue,copyText:Ve,left:$e,image:Be,right:Ge,buttons:Ne};function F(d){return typeof d=="function"||Object.prototype.toString.call(d)==="[object Object]"&&!X(d)}const[Oe]=de("pages-dialogs-login-register"),Xe=K({name:Oe,setup(){const{onDialogOpen:d,visible:R,openOptions:g,closeDialog:v}=se("registerConfirm");te();const D=ae(),{t:s}=L(),{validate:w,setFieldError:P}=pe(),{isRegistered:k}=fe(),n=le(),t=h(!1),b=h(!1),r=h(!1),_=h(!1);ie("CONFIG_CHANGE_SUCCESS",()=>w());const l=h(),p=h(),{saveImage:U}=he({colorSelector:".registerConfirmDialog .ui-dialog__main",buildSelector:".registerConfirmDialog .savepic",preBuildDeps:[t]}),y=E(()=>{var o,i;return((i=(o=D.systemInfos)==null?void 0:o.loginRegister)==null?void 0:i.passwordDefaultPlainText)===ne.OPEN});d(o=>{l.value=O(o==null?void 0:o.form),p.value=O(o==null?void 0:o.form),_.value=y.value,re.preloadGeeGuardToken()});const I=E(()=>{const{phonePass:o,phonePassCode:i,emailPass:c,emailPassCode:m}=n.value;return!(o||i||c||m)}),C=()=>{t.value=!t.value},j=E(()=>{var u,f;const o=s("lobby.modal.login.form.username.labelShort"),i=(u=l.value)==null?void 0:u.platformId,c=s("lobby.modal.login.form.userpass.label"),m=(f=l.value)==null?void 0:f.passwd;return"".concat(o,":").concat(i," ").concat(c,":").concat(m)}),$=E(()=>{let o;const i=I.value?s("lobby.modal.loginRegister.registerSuccessInfoAccountPassword"):s("lobby.modal.loginRegister.registerSuccessInfoAccount");return t.value?o=I.value?s("lobby.modal.loginRegister.editTitleAccountPassword"):s("lobby.modal.loginRegister.editTitleAccount"):o=I.value?s("lobby.modal.loginRegister.noteTitleAccountPassword"):s("lobby.modal.loginRegister.noteTitleAccount"),{genTips:i,title:o}}),M=()=>{var o,i;C(),l.value&&(l.value.platformId=(o=p.value)==null?void 0:o.platformId,l.value.passwd=(i=p.value)==null?void 0:i.passwd)},q=async()=>{var m,u,f;if(!(await w()).valid)return;const i=(m=l.value)==null?void 0:m.platformId;b.value=!0;const c=await k(i);if(b.value=!1,c)return P("platformId",s("lobby.modal.loginRegister.usernameRegisterd"));C(),p.value.platformId=(u=l.value)==null?void 0:u.platformId,p.value.passwd=(f=l.value)==null?void 0:f.passwd},W=async()=>{var o;if(!r.value){r.value=!0;try{n.value.thirdParty?await N().thirdPartyRegister(l.value):await N().register(l.value);const i="".concat((o=l.value)==null?void 0:o.platformId,"_").concat(_e().format("MMDD"),"_").concat(s("lobby.modal.register.label"));await U(i,()=>{var c,m,u,f;v("registerConfirm"),(m=(c=g.value)==null?void 0:c.onSuccess)==null||m.call(c),(f=(u=g.value)==null?void 0:u.onRegisterSuccess)==null||f.call(u),setTimeout(()=>r.value=!1)})}catch(i){r.value=!1,ge(i),ve("CONFIG_CHANGE_ERR").emit(),t.value=!0}}};return()=>{let o,i,c,m;return e(me,{show:R.value,"onUpdate:show":u=>R.value=u,class:[a.registerConfirmDialog,"registerConfirmDialog"],showCloseButton:!1,closeOnRouteChange:!1},{default:()=>{var u,f;return[e("div",{class:a.registerConfirm},[e("div",{class:["savepic",a.imageWrap]},[e("div",{class:a.title,"data-editing":t.value},[$.value.title]),e("div",{class:a.subTitle},[e("span",{class:a.success},[s("lobby.modal.loginRegister.registerSuccessTitle")]),$.value.genTips,e("span",{class:a.infoText},[s("lobby.modal.loginRegister.registerSuccessSecurity")])]),!t.value&&e("ul",{class:a.showInfo},[e("li",{class:a.showItem,onClick:C},[e("span",{class:a.icon},[e(T,{src:"/lobby_asset/common/web/common/input_icon_zh.svg"},null)]),e("span",{class:a.label},[s("lobby.modal.login.form.username.labelShort"),G("：")]),e("span",{class:a.info},[(u=l.value)==null?void 0:u.platformId]),e("span",{class:a.edit},[e(T,{src:"/lobby_asset/common/web/login/login_icon_bj.svg"},null)])]),Y(e("li",{class:a.showItem,onClick:C},[e("span",{class:a.icon},[e(T,{src:"/lobby_asset/common/web/common/input_icon_mm.svg"},null)]),e("span",{class:a.label},[s("lobby.modal.login.form.userpass.label"),G("：")]),e("span",{class:a.info},[(f=l.value)==null?void 0:f.passwd]),e("span",{class:a.edit},[e(T,{src:"/lobby_asset/common/web/login/login_icon_bj.svg"},null)])]),[[J,I.value]])]),t.value&&l.value&&p.value&&e("form",null,[e(ye,{required:!0,name:"platformId",disablePureNumberAccount:!0,modelValue:l.value.platformId,"onUpdate:modelValue":x=>l.value.platformId=x},null),I.value&&e(Q,null,[e(ue,{required:!0,useConfig:!0,name:"passwd",placeholder:s("lobby.modal.login.placeholder.passwd"),modelValue:l.value.passwd,"onUpdate:modelValue":x=>l.value.passwd=x,account:l.value.platformId,visiblePassword:_.value,"onUpdate:visiblePassword":x=>_.value=x},null)])])]),!t.value&&e(ce,{class:a.copyText,text:j.value},{default:()=>[e("span",{class:a.left},[s("lobby.modal.loginRegister.copy")]),e(T,{class:a.image,src:"/lobby_asset/{layout}-{bg}-common/web/common/comm_icon_copy.svg"},null),e("span",{class:a.right},[s("lobby.modal.loginRegister.toSave")])]}),e("div",{class:[a.buttons]},[t.value?[e(A,{block:!0,plain:!0,type:"primary",onClick:M},F(c=s("lobby.modal.loginRegister.cancelEdit"))?c:{default:()=>[c]}),e(A,{class:a.btn,block:!0,loading:b.value,onClick:q},F(m=s("lobby.modal.loginRegister.confirmEdit"))?m:{default:()=>[m]})]:[e(A,{block:!0,plain:!0,type:"primary",clearBackground:!0,disabled:r.value,onClick:C},F(o=s("lobby.modal.loginRegister.editAccount"))?o:{default:()=>[o]}),e(A,{block:!0,loading:r.value,onClick:W},F(i=s("lobby.modal.loginRegister.saveImageAndRegister"))?i:{default:()=>[i]})]])])]}})}}});export{Xe as default};
//# sourceMappingURL=RegisterConfirmIndex.BOQbX4B_.js.map
