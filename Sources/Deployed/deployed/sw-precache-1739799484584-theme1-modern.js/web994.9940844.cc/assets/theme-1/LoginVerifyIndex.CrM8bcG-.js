import{hX as $,hC as P,fK as C,bY as m,gu as b,a as _,u as D,bV as U,go as R,gp as F,Y as H,q as E,c as I,A as q,w as j,g5 as W,gm as A,hY as z,bU as G,hM as Y,aa as K}from"./main.C8q1iJMV.js";import{S as X,q as k}from"./Setting.CRobMkOU.js";import{S as J}from"./Steps.B3IX-idj.js";import{e as Z,D as M}from"../vendors/vendor-default.CjiYZF7Q.js";import"../vendors/vendor-bignumber.BRr1dcww.js";import"../vendors/vendor-swiper.ZXc-sUCV.js";import{d as ee}from"../vendors/vendor-stable.LD58Pbb3.js";import{h as N,n as oe,f as Q,l as L,p as s,C as x,F as te}from"../vendors/vendor-@vue.DNlpgob2.js";import{g,z as se,U as ne}from"../vendors/vendor-lodash.BYdGDldS.js";import{U as B}from"./Username.LtKw3882.js";import"../vendors/vendor-@sentry.EjpkRnd3.js";import"../vendors/vendor-dom-to-image.C12bjAh8.js";import"../vendors/vendor-@intlify.BmUtFfVu.js";function ae(){return{desPhone:async n=>{var r;const[,e]=await Z($(n));return(r=e==null?void 0:e.data.data)==null?void 0:r.phone}}}const w=ee("loginVerify",()=>{const o=N({username:void 0,verify:void 0,verifys:[],loading:!1}),n=N({});return{state:o,options:n,setLoading:()=>{o.loading=!0},delLoading:()=>{oe(()=>o.loading=!1)}}});function ie(){const{openOptions:o}=P("loginVerify");return Q(()=>{var r,l;const n=!!((r=o.value)!=null&&r.onlyPhone),e=!!((l=o.value)!=null&&l.onlyEmail);return{loginVerifyPhone:n,loginVerifyEmail:e,loginVerify:!n&&!e}})}function re(o){const n=w(),e=C(),r={[m.PHONE]:b.PHONE,[m.EMAIL]:b.EMAIL,[m.GA]:b.GA,[m.QUESTION]:b.QUESTIONS,[m.WITHDRAWPASS]:b.WITHDRAW_PASS};return{secondVerify:Q(()=>{var c;return{type:(c=g(r,n.state.verify))!=null?c:b.NONE,phone:e.format(g(o,"phone"))||void 0,phoneCode:g(o,"phoneCode"),email:g(o,"email"),emailCode:g(o,"emailCode"),googleCode:g(o,"gaCode"),passQuestionId:g(o,"questionId"),passQuestionAnswer:g(o,"questionAnswer"),withdrawPass:"".concat(g(o,"withdrawPass"))}})}}const le="_verify_15kod_17",ce="_label_15kod_17",ue="_line_15kod_21",pe="_button_15kod_25",S={verify:le,label:ce,line:ue,button:pe};function de(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!x(o)}const[fe]=E("login-verify"),ye=L({name:fe,setup(){const o=M(),{t:n}=_(),e=w(),r=D(),l=C(),{openLoginRegister:c}=U(),{openOptions:V,closeDialog:a}=P("loginVerify"),{secondVerify:d}=re(o.values),f=async()=>{var i,h,v;if(e.state.loading||!(await o.validate()).valid)return;e.setLoading();const t={...(i=V.value)==null?void 0:i.form,secondVerify:{...se(d.value,ne),loginPass:(v=(h=V.value)==null?void 0:h.form)==null?void 0:v.userpass}};try{await I().login(t,{onBeforeSuccess(){return new Promise(u=>{q.lock(),r.close("loginVerify"),e.delLoading(),j({type:"success",message:()=>n("lobby.common.components.auth.status.verifySuccess"),onClosed(){var y,O;(O=(y=V.value)==null?void 0:y.onSuccess)==null||O.call(y),u()}})})},async onUsernameOrUserpassError(u){W("RESPONSE_ERROR").emit({message:u}),setTimeout(()=>{c({login:!0,openType:"insert"}).then(()=>{a("loginVerify")})},2500)}})}catch(u){e.delLoading()}};return()=>{let p;return s("div",{class:S.verify},[s(B,{disabled:!0,name:"placeformid",rules:()=>!0,modelValue:e.state.username},null),s("div",{class:S.line},null),s(X,{active:e.state.verify,"onUpdate:active":t=>e.state.verify=t,sources:e.state.verifys,attrs:{[m.PHONE]:{createVerify:{type:"account",value:e.state.username},desc:e.options.phone,showCode:!0,attrs:{phone:{placeholder:R(e.options.phone),lockAreaCode:l.parser(e.options.phone).code}}},[m.EMAIL]:{createVerify:{type:"account",value:e.state.username},desc:e.options.email,showCode:!0,attrs:{email:{placeholder:F(e.options.email)}}},[m.QUESTION]:{attrs:{question:{defaultValue:e.options.securityQuestion}}}}},null),s("div",{class:S.button},[s(H,{type:"primary",block:!0,onClick:f,loading:e.state.loading},de(p=n("lobby.common.tips.confirm"))?p:{default:()=>[p]})])])}}});function me(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!x(o)}const[ge]=E("login-verify"),he=L({name:ge,setup(){const o=M(),{t:n}=_(),e=w(),r=D(),l=C(),{openOptions:c}=P("loginVerify"),V=async()=>{var t,i,h;if(e.state.loading||!(await o.validate()).valid)return;e.setLoading();const d=o.values.phoneCode,f=e.state.username?l.format(o.values.phone):(i=(t=c.value)==null?void 0:t.form)==null?void 0:i.phone,p={...(h=c.value)==null?void 0:h.form,phone:f,secondVerify:{type:b.PHONE,phone:f,phoneCode:d}};try{await z({data:{phone_number:f,captcha:d}}),await I().login(p,{onBeforeSuccess(){return new Promise(v=>{q.lock(),r.close("loginVerify"),e.delLoading(),j({type:"success",message:()=>n("lobby.common.components.auth.status.verifySuccess"),onClosed(){var u,y;(y=(u=c.value)==null?void 0:u.onSuccess)==null||y.call(u),v()}})})}})}catch(v){e.delLoading()}};return()=>{var d,f,p,t;let a;return s("div",{class:S.verify},[e.state.username?s(te,null,[s(B,{disabled:!0,name:"placeformid",rules:()=>!0,modelValue:e.state.username},null),s("div",{class:S.line},null),s(k,{type:A.Verify,createVerify:{type:"account",value:e.state.username},showCode:!0,attrs:{phone:{placeholder:R(e.options.phone),lockAreaCode:l.parser(e.options.phone).code}}},null)]):s(k,{type:A.Verify,target:l.parser((f=(d=c.value)==null?void 0:d.form)==null?void 0:f.phone).phone,showLabel:!1,showCode:!0,attrs:{phone:{disabled:!0,lockAreaCode:l.parser((t=(p=c.value)==null?void 0:p.form)==null?void 0:t.phone).code}}},null),s("div",{class:S.button},[s(H,{type:"primary",block:!0,onClick:V,loading:e.state.loading},me(a=n("lobby.common.tips.confirm"))?a:{default:()=>[a]})])])}}}),ve="_loginVerifyDialog_1eqzx_17",Ve="_loginVerify_1eqzx_17",T={loginVerifyDialog:ve,loginVerify:Ve},[be]=E("pages-dialogs-login-register"),Ue=L({name:be,setup(){const{t:o}=_(),{visible:n,openOptions:e,onDialogOpen:r}=P("loginVerify"),{loginVerifyConfig:l}=G(),{openLoginRegister:c,usePageing:V}=U(),a=w(),d=ie(),f=ae();r(async()=>{var h,v,u,y;const t=(h=e.value)==null?void 0:h.form,i=(v=e.value)==null?void 0:v.userInfos;switch(!0){case d.value.loginVerifyPhone:(t==null?void 0:t.loginType)===Y.Account&&t.username&&(a.state.username=t.username,a.options.phone=await f.desPhone(t.username)),a.state.verifys=[m.PHONE],a.state.verify=m.PHONE;break;default:a.state.username=(u=i==null?void 0:i.loginVerifyInfo)==null?void 0:u.username,a.state.verifys=l(i==null?void 0:i.loginVerify),a.state.verify=a.state.verifys[0],a.options=(y=i==null?void 0:i.loginVerify)!=null?y:{}}});const p=()=>{switch(!0){case d.value.loginVerifyPhone:return s(he,null,null);default:return s(ye,null,null)}};return()=>s(K,{show:n.value,"onUpdate:show":t=>n.value=t,class:T.loginVerifyDialog,closeControl:{shouldOccupySpace:!0},beforeClose:async()=>(V.value||await c({login:!0,openType:"insert"}),!0)},{default:()=>{var t;return[s("div",{class:T.loginVerify},[s(J,{title:(t=e.value)!=null&&t.onlyPhone?o("lobby.common.components.auth.phone.title"):o("lobby.center.security.twoStepVerification"),step:0,steps:[o("lobby.modal.forgotPassword.step1"),o("lobby.modal.forgotPassword.step3")]},null),p()])]}})}});export{Ue as default};
//# sourceMappingURL=LoginVerifyIndex.CrM8bcG-.js.map
